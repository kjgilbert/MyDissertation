\chapter{Genetic architecture and landscape heterogeneity interact to determine adaptation during species range expansion}%The role of genetic architecture and environmental gradients in adaptation during range expansion}
\label{chap:heterogeneouslandscapes}

\section{Abstract}


\section{Introduction}

% speciation, local adaptation, range expansion are all about adaptation to novel environments
%	in particular, adaptation in the face of gene flow

% it is still today a major question in evolutionary biology what alleles contribute to local adaptation
% and equally unknown (?) and much more hotly debated is how many genes are needed for speciation to occur? few or many? or a whole genome? or one magic trait?

% by examining range expansion over different types of heterogeneous environments and with different underlying genetic architectures, we investigate the ability for populations to colonize new habitat and adapt in order to undergo a species range expansion


%discuss the question of adaptation broadly - it's important in many aspects of evolution
The question of why species range limits exist has pervaded evolutionary biology for decades. Understanding populations' abilities to adapt to novel environments is key to understanding range expansions, and is a major area of study across evolutionary biology in studies of speciation, local adaptation, invasive species, and conservation biology. Populations are known to locally adapt within their species range to survive across a range of disparate environments \citep{Kawecki:2004}. If this is possible, then why can populations not continue to locally adapt past a range edge? 
%%On a more extreme scale, populations may eventually span such dissimilar environments that they reach a point of sufficient differentiation to produce new, isolated species adapted to different environments \citep{Rundle:2005, Doebeli:2003}. 
Adaptation to new environments determines the capacity of invasive species to thrive \citep{Prentis:2008}, and the potential for success of new genetic diversity from attempts of assisted migration \citep{Aitken:2013}. 
%%Regardless of whether adaptation results in the formation of new species or differentiated local populations, it remains a major question in evolutionary biology as to which and how many genes contribute to local adaptation. 

% talk about genetic architecture
Apart from range expansions, it remains a major question in evolutionary biology as to which and how many genes contribute to local adaptation. Many studies, both empirical and theoretical, examine genetic architecture and its role in the ability to adapt to a novel environment \citep{Yeaman:2015, Yeaman:2011, Carroll:2001, Holloway:1990, Peichel:2001, Bratteler:2006, Schiffers:2014}. It is known that a sufficient level of genetic variation, $V_G$, is necessary to provide the alleles required for adapting to a new environment. It was previously thought that many alleles of too small an effect may be swamped by gene flow before being able to contribute to sufficient local adaptation, but as shown by \citep{Yeaman:2015}, local adaptation via many genes of small effect is possible. This occurs through transient processes subject to random genetic drift when rates and sizes of mutations and genetic redundancy are sufficient (though detecting the presence of such alleles remains a difficult task). It is clear however, that fewer loci of larger effect can contribute best to adaptation, which eventually lead to the building up of linked clusters of locally adapted alleles, often referred to as genomic islands of divergence \citep{Feder:2010}. Even when small effect alleles may contribute to adaptation, larger effect alleles build up and contribute to adaptive differences among populations \citep{Yeaman:2011}. As \citet{Renaut:2013} have shown in sunflower species, genetic architecture plays a larger role in contributing to genomic divergence than does the geography of speciation. %make sure to go back and see what they mean by this "geography"
The details of genetic architecture are thus vital in studies of adaptation, and should not, nor need not, be ignored in today's era of genomic technologies. % eh, maybe remove the last part here, I am only doing a simulation study after all

% talk about range expansions over linear gradients

Incorporating investigations of various types of genetic architecture into studies of range expansions may have broad implications for understanding how species will be able to adapt and cope with global climate change. Foundational theoretical work on range expansions over environmental gradients showed that on a linear environmental gradient, increasing steepness of the change in environmental optimum eventually leads to maladaptation at the margin and eventual extinction of the species \citep{Kirkpatrick:1997}. %Improving upon this study by allowing realistic and evolving genetic variance showed no limits to adaptation at a range margin, and a wider range of results when investigating temporally changing environments and varying population densities \citep{ polechova
Further investigations have improved upon this and shown the effects of density dependent selection \citep{GarciaRamos:1997} as well as stochastic effects on low density \citep{Bridle:2010}, temporal changes in environments \citep{Pease:1989}, differing dispersal parameters \citep{Aguilee:2012}, evolution of genetic variance \citep{Barton:2001,Polechova:2009}, and the impacts of genetic drift  \citep{Polechova:2015} on adaptation or the lack thereof at range margins. %\citet{Case:2000} also incorporated species competition, under which they found similar results only with a shallower environmental gradient needed to limit range expansion. Some of these models use the same linear gradient of an environmental optimum changing at a constant rate over continuous space, while others simulate adaptation to differing environmental optima across discrete space (habitat patches) within which  individuals of a patch possess no explicit spatial designation. The results of these discrete environment models also show the potential for species to either adapt and persist, exist as non-adapted generalists, or go extinct.
%  **** include this and improve on the summary of other studies? --> One may predict that a given difference in optimum phenotype can be attained equally from few loci of large effect or many of small effect, but such a process will clearly rely on important details of migration, mutation, selection, and genetic drift. (cite someone here?) Strong asymmetric migration can swamp locally beneficial alleles and prevent adaptation (cite Kirkpatrick and barton, and others). Weak selection and strong genetic drift can prevent beneficial alleles from establishing (true??). And mutation may drive the presence of genetic variation needed to allow adaptation to novel conditions.

These studies have all investigated adaptation in models of linear environmental gradients in continuous space. Further theoretical studies have investigated adaptation across two disparate patches different environmental optima. \citet{Ronce:2001} showed that if selection is strong enough within each habitat or migration reduced enough, this can prevent the establishment of foreign alleles in a new population allowing it to adapt sufficiently to local conditions. While others have shown that evolutionary rescue from migration into marginal populations of small effective population sizes which otherwise behave as sinks can then reach a self-sustaining level, adapt, and persist \citep{Holt:1997,Gomulkiewicz:1999,Ching:2012}. The level of gene flow across a species range can greatly affect the outcome for adaptation and range expansion. Higher gene flow has been shown to introduce more maladaptive alleles from greater distances and thus be more detrimental to the local population \citep{GarciaRamos:1997}.

The effects of landscape structure can thus have a large impact on range expansions. These previous studies have investigated range expansions over linear gradients and adaptation across two patches in space, but the intermediate situation of environments that change heterogeneously over space adds necessary biological realism. These differences in landscape play a key role in the process of populations adapting because of their potential to interact with the effects of evolutionary processes at the range margin and may potentially change outcomes of adaptation beyond expectations from either of these previous model.  





%% PICK UP HERE
contiguous space with varying levels of gradual or abrupt environmental changes distributed patchily across space. These differences in landscape play a key role in the process of populations adapting because of their potential to interact with the effects of evolutionary processes at the range margin. 



% talk about adding in the realism of heterogeneous landscapes and give the schiffers example

% talk about landscape heterogeneity - in broad terms
Whether a certain genetic architecture will successfully contribute to adaptation in a new environment will also depend largely on the environmental difference at hand. There are clearly biological limits that exist in terms of adapting to environments of extreme difference in optimal phenotype, but within the realm of biological reality, there may still be limits to the change in environmental optimum to which a given genetic architecture allows adaptation. Previous theoretical studies have investigated adaptation over linear gradients and the ability for range expansion. Real world environments are often more complex than linear gradients of environmental change. Environments are heterogeneous and can change in multifarious ways over space, from gradual to sudden, and of minor or major magnitudes of change over space. Species are known to exist across continuous gradients, for example temperature changes latitudinally across many species ranges. Changes in temperature or other environmental variables that populations must adapt to can occur more heterogeneously in space as well \citep{Pickett:1997}, for example with bioclimatic regions, patches of forest or meadow, elevational gradients with distinct regions of environments such as above or below the timberline, or changes in soil conditions along slopes. Lastly, species are also known to exist across scenarios similar to two-patch models, for example plants living on and off patches of serpentine soils \citep{Brady:2005}.  \citet{Schiffers:2014} have investigated the role of adaptation across patches of heterogeneous environment, but it has not yet been investigated how the degree of change in these optima will impact the outcome of adaptation during range expansion.

MORE ABOUT WHAT TYPES OF HET LANDSCAPES EXIST BIOLOGICALLY

%The potential for genetic architecture underlying adaptation to interact with the environment to which populations are adapting is however less well understood. \emph{somewhere in here need to link better to the fact that I'm focusing on range expansions} %%

% talk about landscape heterogeneity in terms of range expansions
When considering environmental heterogeneity in terms of adaptation during range expansions, there are several important genetic processes that can lead to interesting hypotheses for adaptation across the landscape, making range expansions ideal for studying the combination of these effects. 
% Species exist on environmentally heterogeneous landscapes, and the degree of this heterogeneity can vary greatly within species ranges.
The characteristics of the environment available for a species to expand into plays an important role in the ability of populations to expand \citep{Aguilee:2012, Barton:2001, Pease:1989}. Increasing habitat heterogeneity, and thus heterogeneity in selective pressures, interacts with gene flow to influence the adaptive abilities of peripheral populations, and can in some cases inhibit local adaptation in peripheral populations \citep{Slatkin:1987,Kirkpatrick:1997, Ronce:2001}. During a range expansion, small founder populations at the margin experience reduced effective population sizes and reduced efficacy of selection. When this process repeats over the course of an expansion, the process of gene surfing \citep{Klopfstein:2006} can increase the presence of deleterious alleles and cause an expansion load at the range margin \citep{Peischl:2013}. This process is examined in more detail by Gilbert \emph{et al.} (\color{red} \footnotesize hopefully submitted \normalsize \color{black}). %or remove this sentence and just talk about dispersal?
Due to reduced density at range margins, these populations experience gene flow at much higher proportions than any populations existing within the denser core os the species range. This asymmetric migration can behave in two disparate ways: introducing new genetic variation needed for further adaptation in an otherwise genetically depauperate population, or swamping locally adaptive alleles with foreign maladaptive alleles thus preventing further adaptation. Which of these processes occurs will depend on the details of migration rates, mutation rates, population sizes, and the degree to which the environment differs across the species range.

Previous theoretical studies have examined many of these aspects and their role in local adaptation at range margins during the expansion process. Higher gene flow has been shown to introduce more maladaptive alleles from greater distances and thus be more detrimental to the local population \citep{GarciaRamos:1997}. While others have shown the effect of evolutionary rescue from migration when marginal populations have small effective population sizes and behave as sinks \citep{Holt:1997,Gomulkiewicz:1999,Ching:2012}. Alternatively, if selection is strong enough or migration reduced enough, this can prevent the establishment of foreign alleles in a population allowing it to adapt sufficiently to local conditions \citep{Ronce:2001}. 



% set up our hypotheses/goals
When discrete habitat types exist contiguously across space, will the dynamics of the system reflect those of the continuous or the discrete models? %The combination of such environmental landscapes however, has not been sufficiently explored. 
\citet{Barton:2001} suggested the ability of populations to persist across environments of accelerating gradients, but in depth examination of different types of environmental heterogeneities is warranted. Because discrete models have as of yet not extended past two patches, it is unclear what effects a third or additional patches may have on evolution and adaptation within the system when space is explicit within each patch. With larger environmental differences in optima, will only large effect mutations be able to contribute to local adaptation and small effect alleles still swamped at the range margin?


















% this project's hypotheses
In this study, we test if different genetic architectures and landscape heterogeneities can interact and affect the outcome of adaptation during a species range expansion, and potentially even limit a species range expansion. We compare our results to predictions from \citet{Barton:2001} and the results of \citet{Bridle:2010} and \citet{Schiffers:2014} to assess the impacts of our further explorations into genetic architecture and environmental heterogeneity. 
% how we're going to test those hypotheses
To address this question, we simulate a spatially explicit and discrete two-dimensional landscape across which populations expand their species range and adapt to newly encountered environments. We model a range of genetic architectures for a quantitative trait to test for differences in ability to adapt to environments. We also compare this across environments that differ in their degree of environmental heterogeneity from few to many locations of change in environmental optima, as well as in terms of the magnitude of change for each of these optima. Examining the rate of range expansion and the time required for populations to colonize and adapt in new environments provides insight into the role of both genetic architecture and environmental heterogeneity in determining the success or failure of adaptation. Such results are highly informative for the field of evolutionary biology, and largely applicable in predicting the fate of many species across the globe requiring the ability to adapt in the face of disturbance and shifting species ranges due to climate change and other anthropogenic environmental perturbations.

In this study, we address two main questions. First, do predictions of range expansion from a linear gradient successfully extrapolate to a heterogeneous gradient and why. And second, does the genetic architecture of the system impact where these critical gradients exist for the success or failure of range expansion.




%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>

% marginal populations thus often exist only as a sink, sustained by immigration until sufficient local adaptation is achieved. % and recovery from expansion load? -- refer to Ch 4 here, i.e. refer to our group project paper -- or just talk less about load since I'm not studying it in this paper
% When the population shifts to be a self-sustaining source, it escapes the effects of drift, and provides emigrants for further colonization and range expansion. This shift from sink to source also includes a shift away from asymmetric migration previously swamping locally adaptive alleles with foreign maladaptive alleles.

%Local adaptation within a species not only benefits populations in terms of fitness but also has repercussions for a species' global range. A species' range is defined in some cases by sharp visible boundaries, such as distinct geographical changes in landscape features, or equally understandable ecological reasons such as competitor occurrence or nutrient limitations. In instances where no such clear reason for a range edge exists, understanding what forces limit expansion and adaptation at the edge of a range becomes an evolutionary question \citep{Bridle:2007,Kawecki:2008,Excoffier:2009}. Barriers to dispersal may prevent expansion past the edge, however gene flow can also act to inhibit local adaptation in peripheral populations \citep{Slatkin:1987,Kirkpatrick:1997}. This, in combination with different selective forces from environmental gradients across the landscape, may prevent expansion. The characteristics of the environment available for a species to expand into plays an important role \citep{Aguilee:2012,Barton:2001,Pease:1989}. Increasing habitat heterogeneity, and thus heterogeneity in selective pressures, interacts with gene flow to influence the adaptive abilities of peripheral populations \citep{Ronce:2001}.

% Under one of the first models to examine the question of adaptation across species ranges \citep{Kirkpatrick:1997}, it was shown that three different scenarios could result: species extinction, a limited species range, or unlimited expansion of a species. Other studies have examined scenarios similar to this model and incorporated more realistic simulation methods that were previously not investigated: density dependent selection \citep{GarciaRamos:1997,Gomulkiewicz:1999} as well as stochastic effects on low density \citep{Bridle:2010}, temporal changes in environments \citep{Pease:1989}, differing dispersal parameters \citep{Aguilee:2012}, and evolution of genetic variance \citep{Barton:2001,Polechova:2009}. \citet{Case:2000} also incorporated species competition, under which they found similar results only with a shallower environmental gradient needed to limit range expansion. Some of these models use the same linear gradient of an environmental optimum changing at a constant rate over continuous space, while others simulate adaptation to differing environmental optima across discrete space (habitat patches) within which  individuals of a patch possess no explicit spatial designation. The results of these discrete environment models also show the potential for species to either adapt and persist, exist as non-adapted generalists, or go extinct.

%Equally relevant to studying adaptation in a local adaptation or speciation context, is the study of adaptation during a species range expansion. As a species range expands, it encounters novel habitat to which it must adapt. Previous studies have shown that it is the ability of populations at range edges to adapt to these new environments that can determine the ability of a range to expand (citations). Not unlike parapatric speciation, this adaptation to new environments must occur in the presence of gene flow. Asymmetric gene flow at a range edge, however, can cause migration load that is particularly strong when an edge population is still a sink and requiring the influx of individuals to persist.

%Species range limits and the capacity for range expansion has long been a question in evolutionary biology. A species' range is defined in some cases by sharp visible boundaries, such as distinct geographical changes in landscape features, or equally understandable ecological reasons such as competitor occurrence or nutrient limitations. In instances where no such clear reason for a range edge exists, understanding what forces limit expansion and adaptation at the edge of a range becomes an evolutionary question \citep{Bridle:2007, Kawecki:2008, Excoffier:2009}. Barriers to dispersal may prevent expansion past the edge, however gene flow can also act to inhibit local adaptation in peripheral populations \citep{Slatkin:1987, Kirkpatrick:1997}. This, in combination with different selective forces from environmental gradients across the landscape, may prevent expansion. 


%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>



\section{Methods}

%\subsection{Simulation Model}

We model a species range expansion over heterogeneous environments with individual-based, forward time simulations in the program \textsc{nemo} \citep{Guillaume:2006}. We vary two main parameters of interest: the magnitude and heterogeneity of change in environmental optimum in space and the genetic architecture underlying the quantitative trait that allows adaptation to the local environment. We also briefly compare these effects across two cases of small and large average dispersal distances. Our goal is to understand the impact and interactions of genetic architecture and the landscape heterogeneity over which individuals exist in terms of the outcome of range expansion and population adaptation.

We implement a modified version of \textsc{nemo} \citep{Guillaume:2006}, described in Gilbert \emph{et al.} (\Chapref{expansionload}), which allows for a large-scale, two-dimensional species range to be modeled with explicit space. This expands greatly upon existing 2-patch models with non-explicit space within each landscape patch and approaches a model of continuous space. Individuals are monoecious (hermaphroditic), obligately outcrossing diploids which possess a quantitative trait under balancing selection for the local environmental optimum. We initiate the population in a limited region for a burn-in to migration-mutation-selection equilibrium, after which populations expand into empty landscape of various types of heterogeneous environmental optima. Generations are non-overlapping and life cycle events occur in the order of breeding, dispersal, viability selection, and population regulation. We monitor the populations' abilities to spread across the landscape, and when successful, compare these scenarios in terms of expansion speed and fitness as they encounter environments of differing environmental optima to which they must adapt in order to further expand.


% now go into all the gory details:
\subsection{Landscapes}

To approximate continuous space and maintain a spatially explicit landscape with discrete populations, we implemented a large spatial grid of habitat patches in \textsc{nemo}. This bridges the gap between existing two-patch landscape models, where existence within either of these two patches is not spatially defined, and models of continuous space. The landscape is a rectangular grid of $40\times2000$ cells with a defined phenotypic optimum and carrying capacity for every cell in the landscape. 
This greatly builds upon the model of \citet{Schiffers:2014} which examined a grid of $16\times64$ cells. We term the leftmost $40\times40$ cells of the landscape the core, which is where the burn-in period occurs. After burn-in, expansion proceeds along the long ($x$) axis of the landscape into the remaining $40\times1960$ cells. The core consistently possessed a constant optimum phenotypic value of $0$ to ensure that the population was well-adapted before populations expanded onto environmental gradients. In all cases, the environmental optimum only changed in one dimension over the axis of expansion (x-axis) and was constant over cross-sections of the landscape (y-axis). Terms for describing these landscape and other parameters are defined in Table \ref{tab:params}.

We examined several types of environmental heterogeneities across landscapes. These range from a linear gradient to only two patches each with a different local environmental optima, as well as combinations in between with multiple patches of constant environmental optima interspersed by sharp changes in the environment. This heterogeneity is representative of multiple types of real world environmental gradients. \color{red}Species are known to exist across continuous gradients, for example temperature changes latitudinally across many species ranges. Changes in temperature or other environmental variables that populations must adapt to can occur more heterogeneously in space as well \citep{Pickett:1997}, for example with bioclimatic regions, patches of forest or meadow, elevational gradients with distinct regions of environments such as above or below the timberline, or changes in soil conditions along slopes. Lastly, species are also known to exist across scenarios similar to two-patch models, for example plants living on and off patches of serpentine soils \citep{Brady:2005}. (moved this to intro)\color{black} Our modeled landscapes of heterogeneous environmental gradients possessing patches of constant phenotypic optima interspersed by changes in phenotypic optima over the landscape are thus not unrealistic biologically. 

To define each type of heterogeneous landscape we modeled, we describe three parameters: the number of changes in environmental optima over the landscape, the magnitude of each of these changes, and the total gradient value across the landscape, which can be calculated from the previous two values. We refer to each change in environmental optima on the landscape as ``steps" since the optimum is constant within a patch then changes in magnitude to the new optimum on a subsequent step. The number of changes, or steps, on the landscape is equivalent to describing the width of each step, since the landscape size is constant over all simulations and no changes occur perpendicular to the axis of expansion. The magnitude of change at a given step is referred to as the step's height, $h_{step}$ (Figure \ref{fig:stepschematic}). Therefore, a linear gradient would be one with $1959$ steps, each with a width of one cell. 

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=0.9\linewidth]{Figures/StepSchematic_Figure.pdf}}
\caption[Schematic of step landscapes.]{Schematic of simplified step landscapes, where step height ($h_{step}$) is the magnitude of change in environmental optimum at one location on the landscape and step width is the number of units in the x-direction contained within a given area of the same environmental optimum. Landscapes depicted with solid lines have the same step height across the landscape, but different total gradients, while the dashed and gray lines show how different numbers of steps of different height can make up a landscape with the same overall gradient. The landscape core in the first 40 units of the landscape is constant, and the linear gradient is where there is a step at every unit x on the landscape outside of the core.}
\label{fig:stepschematic}
\end{figure}


% maybe move to results
We first model linear gradients to determine the critical value, $b_{crit}$ for which expansion could no longer occur. From this we then break down this linear gradient into steps of environmental change to test at what point this prediction of $b_{crit}$ fails to identify successful expansions. This held the total gradient value constant, but changed the frequency of steps and thus also each step's height. To understand why this $b_{crit}$ prediction fails, we then investigate the role of step height alone on a two-patch landscape, and then elucidate the interaction of step height with step width in allowing adaptation and expansion to proceed across the landscape. All results present  the average value for a given parameter across the $y$-axis of the landscape for any given landscape location $x$. 

%%To first determine the factors underlying adaptation to a single, new environment, landscapes with one step were tested for $h_{step} = 5, 7.5, 10, 12.5,$ and $15$. In these cases, $h_{total}$ = $h_{step}$, and essentially mimics a spatially explicit 2-patch model. % For the same total change in optimum over the landscape, but at the other extreme of heterogeneity, i.e. being linear, populations had no difficulty in expanding to fill the landscape when $h_{total} \sim 0.0025, 0.005,$ and $0.0075$.
%%Upon determining the outcomes of success or failure to expand across this single step, we then simulated landscapes with increasing frequencies of steps, while holding $h_{step}$ constant at either 5 or 10, within each simulation. Step frequencies ranging from 4 to 1,959 (linear) steps per landscape were compared, which can equivalently be described as scenarios where the width of a step (the number of cross sections between subsequent steps) ranges from 392 cross sections down to a single cross section between steps on the linear gradient. Because $h_{step}$ is held constant in these scenarios, the total change in environmental optimum across the entire landscape, $h_{total}$, differs across cases of different step frequencies and is simply the product of $h_{step}$ and the number of steps on the landscape. The scenario for $h_{total}$ being held constant is not shown, since linear gradients with $h_{total} = 5, 10,$ or $15$ ($h_{step} = 0.0025, 0.005,$ or $0.0075$) posed no difficulty for any of our simulated populations to expand across and adapt (see Supplemental Figure \color{red}1\color{black}). 
% if I have time for the simulations, add in the description of non-monotonic step landscapes

% Multiple different scenarios can represent the same total change in landscape optimum (Figure 1a) while the frequency of steps in space can also result in different total changes in landscape optimum (Figure 1b).


%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
\begin{table}[h]
\centering \footnotesize
\caption{Terminology and parameter definitions for simulations}
\label{tab:params}
\begin{tabular}{lp{0.8\textwidth}l}
Term		& Explanation  \\ \hline \hline
Cell		& One unit of space on the landscape grid. 40 cells across the y-axis constitute a landscape cross-section. The entire landscape is $40\times2000$ cells.			\\ \hline
Core		& The leftmost $40\times40$ landscape cells. The population is limited to this region during the burn-in period. Environmental optimum is constant within the core.	\\ \hline
Step		& Used to describe an instance of a change in phenotypic optimum on the landscape.															\\ \hline
$h_{step}$ & The magnitude of change in phenotypic optimum across a step in the landscape. In other words, the height of a step.									\\ \hline
$h_{total}$ & The total magnitude of change in phenotypic optimum across the entire landscape. In other words, the sum of all step heights.							\\ \hline
Step width	& The number of landscape cross sections between subsequent changes in environmental optimum. In other words, the number of cross sections between each occurrence of a step in the landscape.	\\ \hline
\emph{K}	& Carrying capacity of a cell. Population regulation occurs at the level of cells. $K = 5$ in all cases.													\\ \hline
$\sigma_{breed}$ & One standard deviation of the Gaussian kernel describing the area of the breeding window. Individuals can find mates within cells contained by the breeding window. $\sigma_{breed} = 0.5\times$cell width in all cases. \\ \hline
$\sigma_{disperse}$ & One standard deviation of the Gaussian kernel describing the area of potential dispersal. Offspring can disperse to cells within the dispersal kernel. $\sigma_{disperse} = 2\times$cell width or $4\times$cell width as described in the text.                                          
\end{tabular}
\end{table}
%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>








\subsection{Breeding \& Dispersal}
The large landscape grid allows regulation at a fine scale across the landscape, which is what allows our simulations to approach a continuous spatial model. Each landscape cell has a carrying capacity set at $K = 5$, which allowed for specification of a fine scale landscape to underly larger populations. We maintain larger effective population sizes through breeding and dispersal which both occur over regions of nearby cells. This creates a neighborhood size of approximately $250$ individuals, calculated from \citet{Wright:1946}. 

The breeding window we introduced into \textsc{nemo} defines a given radius of cells around a focal cell from which an individual can find a potential mate during the breeding life cycle stage and is described in detail in Gilbert \emph{et al.} (\Chapref{expansionload}). Because modeling a range expansion implies that there will often be lone colonists on the expansion front, this addition of a breeding window increases biological realism by allowing lone colonists on the range front to still potentially find a nearby mate, even if they are the sole inhabitant of their cell. This most closely resembles obligately outcrossing plants, who may receive pollen from nearby mates, but could also represent animals that search for mates nearby then return to their home territory. The probability of finding a mate is described by an approximate bivariate Gaussian defined by one standard deviation of a Gaussian distribution, $\sigma_{breed}$, where $f(x,y) \propto \exp{[-(\frac{\Delta x^2}{2\sigma_{breed}^2}+\frac{\Delta y^2}{2\sigma_{breed}^2})]}$ gives the distance traveled to search for a mate in a given direction $x$ and $y$. We discretized these probabilities by integrating the probability over each cell, and then weighted these probabilities by the number of potential mates in each cell within the breeding window. $\sigma_{breed}$ was set at one half of a cell length, and the maximum search radius for a mate was limited to $4\times\sigma_{breed}$. This produced a breeding window containing the $13$ cells: the focal cell and its $12$ surrounding cells. Individual fecundity was drawn from a Poisson distribution with mean $4$ to determine the number of offspring to be produced.

Dispersal occurred similarly to breeding, where a dispersal kernel was defined for forward rates of migration and discretized over cells on the landscape. This distribution was defined by $\sigma_{disperse} = 2\times$ cell size for the majority of simulations. Where specified, a larger dispersal kernel of $\sigma_{disperse} = 4\times$ cell size was implemented. An R wrapper package was created to calculate breeding and dispersal kernels, and to discretize these probabilities across the landscape, and is available online at https://github.com/kjgilbert/aNEMOne. C++ code for the modified version of \textsc{nemo} with a breeding window is available online at https://github.com/kjgilbert/NemoDispersalKernel.

 
\subsection{Viability Selection}
Throughout the simulations, selection occurs only on survivorship, and not fecundity. Selection is stabilizing for the local environment's phenotypic optimum, with fitness of an individual defined by $\omega_z = exp[-\frac{(z-z_{opt})^2}{2V_S}]$, where $z$ is the quantitative trait value, $z_{opt}$ is the optimum phenotypic trait for a given cell on the landscape, and $V_S$ defines the width of the fitness function. We set $V_S = 7.5$, and environmental variance, $V_E$, to $1$. This follows from choice of $V_S$ and $V_E$ in Gilbert \emph{et al.} (\Chapref{expansionload}) where we use $V_E$ to scale our parameter values.%as was derived from \citet{Kingsolver:2001} and \citet{Johnson:2005}.


\subsection{Genetic Architecture}
Individuals possess a quantitative trait that experiences balancing selection to adapt to the local environment. The quantitative trait, $z$, is controlled by 100 freely recombining loci. We held the total mutational variance, $V_m$, available to the system constant at $10^{-2}$, but varied the underlying genetic architectures contributing to the mutational variance. The number of loci, $L$, was also held constant at 100, thus to satisfy $V_m = 2 L \mu \alpha^2$ \citep{Lande:1975}, we varied the per locus mutation rate, $\mu$ and the variance in mutational effect sizes, $\alpha^2$. Four regimes of genetic architecture were investigated as follows. First, we employed one with small effect mutations and a higher mutation rate: $\mu = 10^{-2}$ and $\alpha^2 = 0.005$. Second and third intermediate regimes set $\mu = 10^{-3}$ and $\alpha^2 = 0.05$, and $\mu = 10^{-4}$ and $\alpha^2 = 0.5$. The fourth regime allowed for the largest effect mutations to occur proportionally more often, yet exhibit less frequent mutations overall where $\mu = 10^{-5}$ and $\alpha^2 = 5.0$. \color{red}For a subset of simulations, we also compared the effect of holding $V_G$ constant. According to \citet{Johnson:2005}, $V_G \approx 2 L \sqrt{\mu \alpha^2 V_S}$, thus we held $\mu$ constant at $10^{-5}$ and varied $L$ and $\alpha^2$ at $L = 316$ and $\alpha^2 = 0.5$, and $L = 1000$ and $\alpha^2 = 0.05$. This produced very similar levels of genetic variance in the landscape core with only slight variations of $V_G$ increasing with more loci (Supplemental Figure . ). \color{black} 

 
 

\section{Results}

Results are presented first for expansion over a linear gradient of varying steepness to determine the value of $b_{crit}$, the gradient steepness above which expansion is predicted to fail. All four genetic architecture regimes are presented as well as the small and large dispersal distance comparisons. From these results, we then examine how this $b_{crit}$ prediction compares to the outcome of range expansion on heterogeneous gradients. We investigate the processes and patterns of both landscape and genetic architecture which impact the outcome of these range expansions. \color{red}keep or get rid of this little summary paragraph?\color{black}

\subsection{Expansion on a linear gradient}

We first investigated the critical steepness of a linear gradient, $b_{crit}$. We examined a range of gradient steepness, from $b = 1$ to $b = 5$, and found a $b_{crit}$ value below which expansion could successfully proceed, but that this $b_{crit}$ value varied depending on the genetic architecture modeled. For the first genetic architecture of  $\mu = 10^{-2}$ and $\alpha^2 = 0.005$, expansion occurred at and below $b = 4$, making $b_{crit}$ between $4$ and $4.5$. For the second genetic architecture of  $\mu = 10^{-3}$ and $\alpha^2 = 0.05$, expansion occurred at and below $b = 3.5$, making $b_{crit}$ between $3.5$ and $4$. For the third genetic architecture of  $\mu = 10^{-4}$ and $\alpha^2 = 0.5$, expansion occurred at and below $b = 3$, making $b_{crit}$ between $3$ and $3.5$. Lastly, for the fourth genetic architecture of  $\mu = 10^{-5}$ and $\alpha^2 = 5.0$, $b_{crit}$ underwent a qualitative change, and expansion occurred again at and below $b = 4$, making $b_{crit}$ between $4$ and $4.5$.

In all cases where expansion occurred, it proceeded more slowly as the gradient steepness approached $b_{crit}$ (Figure \ref{fig:linearspeed}). For the fourth regime, $\mu = 10^{-5}$ and $\alpha^2 = 5.0$, only 2 replicates out of 10 successfully expanded, producing the calculated growth rate and $b_{crit}$, but these scenarios also spent a significant time after the burn-in of \color{red}about 10,000 \color{black} generations, without proceeding to expand across the landscape, and only then began to colonize empty landscape. A similar phenomenon was observed for the third regime, $\mu = 10^{-4}$ and $\alpha^2 = 0.5$, where populations again required additional time after burn-in spent within the core before expansion occurred. In these cases, expansion began for all replicates within \color{red}5,000 \color{black} generations, but after an average time spent stalled at the step of \color{red}2500 \color{black} generations. The total population size maintained across the landscape was also lower as gradient steepness increased towards $b_{crit}$ (\color{red}Supplemental Figure or maybe not supp fig of pop sizes.\color{black} ). 

\citet{Barton:2001} derives predictions for the value of $b_{crit}$, which depend on the genetic variance: $b_{crit} = \frac{V_G}{\sigma \sqrt{V_S}}$, where $\sigma$ is the standard deviation of distance travelled by combining both gamete and offspring dispersal, i.e. $\sigma = \sqrt{\sigma_{disperse}^2 + \frac{1}{2}\sigma_{breed}^2}$. We find that the genetic variance across the landscape increases in scenarios of steeper environmental gradients (Supplemental Figure . ). Because the genetic variance evolves differently on each gradient, this is not a useful value in predicting $b_{crit}$ for our simulations, however we can attempt to predict a $b_{crit}$ using the genetic variance from the landscape core. Doing so estimates a $b_{crit}$ for each genetic architecture respectively: $\approx 0.161, 0.125, 0.018,$ and $0.002$ (for $\mu = 10^{-2}, 10^{-3}, 10^{-4},$ and $10^{-5}$, respectively), a large underestimate of our realized $b_{crit}$ values. There are multiple reasons for this disparity in $b_{crit}$, which we consider in the Discussion.

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=0.6\linewidth]{Figures/GrowthRateZoomedIn.pdf}}
\caption[Growth rate of populations expanding over a linear gradient.]{Growth rate of populations expanding over a linear gradient, from $b = 1$ to $b = 5$ and for the small and large dispersal distances. The four different regimes of genetic architecture are indicated along the x-axis, and points are jittered. Below the gray dashed lines are cases that the population did not expand out of the core. Error bars indicate 95\% confidence intervals.}
\label{fig:linearspeed}
\end{figure}

For the same gradient values and genetic architectures, we examined the outcome for dispersal distances twice as large to assess how this impacted the ability for range expansion and the value of $b_{crit}$. The predicted $b_{crit}$ for these scenarios is $\approx 0.082, 0.063, 0.009,$ and $0.0008$, respectively; values which are approximately half of the predictions for the smaller dispersal kernel. Our realized $b_{crit}$ values in these larger dispersal cases again much larger than the predicted value using $V_G$ as estimated in the core, but were also much smaller than each respective $b_{crit}$ for the smaller dispersal cases. For the two largest mutation rate and lowest mutation effect size regimes, $b_{crit}$ was between 2 and 3, while for the two smallest mutation rate and largest mutation effect size architectures, $b_{crit}$ was between 1 and 2 (Figure \ref{fig:linearspeed}).


% could calculate b_crit at the largest Va found possible before extinction occurs, what does it predict??



%%, as a comparison to existing literature.
%%when is b too steep on a linear gradient?
%%	might need to calculate b as the gradient within a sigma or something like that...
%%what value of b is it above which no expansion occurs
%%even when expansion occurs on lower values of b, the lower the b, there are still differences
%%speed of expansion
%%total pop size across the landscape
%%fitness?






\subsection{Expansion over heterogeneous gradients}

Our measured $b_{crit}$ values define the slope of change over the environment on a linear gradient, but this gradient can consist of local heterogeneity while still overall possessing the same value of $b$ as measured across the entire landscape. This next set of simulations examines if and when the prediction from our measured $b_{crit}$ for each genetic architecture regime fails to describe the outcome of range expansion when we vary the degree of heterogeneity of change over the landscape. 

We chose two weak gradient value for which expansion on a linear gradient was successful and maintain the same total change in environmental optimum from one end of the landscape to the other. However, in these simulations, we divide the makeup of that change into different numbers of steps across the landscape. Within a given simulation, the height of a step is constant, but across simulations the height of a step varies as the number of steps varies. The total change in optimum over the landscape for each of these two gradients was 15 and 30 units. For a linear gradient, this is equivalent to $b \approx 0.0075$ and $b \approx 0.015$. For the heterogeneous. non-linear  gradient broken into steps, we divide the landscape into a range of 979 steps down to 1 step which then varies step height from $h_{step} = 0.015$ to $15$ and from $h_{step} = 0.03$ to $30$, for each overall gradient respectively. 

On a gradient of total change in optimum of 15, we found that expansion occurs in all cases except for the scenario when the landscape only consists of one step in environmental change, i.e. where $h_{step} = 15$. One individual replicate did expand above a single step of height 15, when $\mu = 10^{-3}$ and $\alpha^2 = 0.05$, after 10,000 generations of remaining below the step, but this was one replicate out of 20 for that genetic architecture regime, and no simulation from the other regimes for each of their 20 replicates ever expanded past a step of this height. In this case, the total change in environmental optimum across the landscape is localized to this one step's location on the landscape. On a gradient of total change in optimum of 30, we found that expansion occurs
%
\color{red} fill these results in \color{black} 
%
The observed $b_{crit}$ on a linear gradient fails to predict expansion on these heterogeneous gradients, since in both cases, the overall gradient is weaker than any tested for our linear gradients. However, these heterogeneous gradients have sharper, local changes in phenotypic optimum across the landscape which may drive this ability to adapt and expand across the landscape. The two different overall gradients tested and each genetic architecture regime do produce different population growth rates on the landscape, as shown in \color{red}Supplemental Figure XX\color{black}. The ability to adapt and expand past one sharp change in environmental optimum is investigated in the next section.

% On these weak overall gradients, the prediction from our observed $b_{crit}$ on a linear gradient fails to predict expansion over an individual step, but further examining the ability to expand over one step as well as introducing additional steps on a steeper gradient also shows the failure of $b_{crit}$ as predicted from a linear gradient.

% does expansion take longer as more steps are added
% does fitness go down and variance up?

%%total h = 15 runs expand fine
%%one step h = 15 runs never expand (almost, except that one case)
%%where on the steppiness continuum does the b prediction from linear gradients fall apart?
%%total h is still the same in all these cases

\subsection{Expansion across one change in environmental optimum}

To investigate why $b_{crit}$ fails to predict expansion over heterogeneous gradients, we examine individual sharp changes in the optimum to explore the role of step height alone. We do this by simulating models of one one step on the landscape (two habitat patches on either side) and vary the value of $h_{step}$. We compare the results for $h_{step} = 5, 7.5, 10, 12.5,$ and $15$. From the previous section, we have already shown that expansion does not occur across steps of height 15 (excepting 1 out of 80 replicates, 1.25\%) or higher.

In all genetic architectures, we find that expanding over one step of height 5 caused no difficulties and expansion proceeded immediately upon populations reaching the location of the step on the landscape. At $h_{step} = 7.5$, expansion becomes more difficult for the third genetic architecture regime, $\mu = 10^{-4}$ and $\alpha^2 = 0.5$, but all replicates successfully expand within 2,500 generation of having reached the step. An interesting phenomenon is seen at $h_{step} = 10$, where expansion is minimally slowed (within 500 generations of reaching the step) for $\mu = 10^{-2}$, more substantially slowed (within 2,000 generations of reaching the step) for $\mu = 10^{-3}$, and then no expansion occurs within the duration of the simulations for all 20 replicates when $\mu = 10^{-4}$. However, at $\mu = 10^{-5}$, expansion again proceeds for 19 of 20 replicates (95\%), with large variation in time stalled at the landscape step (\color{red}XX - YY generations [mean = ]\color{black}). For $h_{step} = 12.5$, expansion only occurs in the first two genetic architecture regimes of highest mutation rate, with substantial time stalled at the step (\color{red}XX - YY generations [mean = ]\color{black}; Figure \ref{fig:waittimes}).



\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1\linewidth]{Figures/wait_times.pdf}}
\caption[Time spent stalled during step crossing.]{Time spent (in generations) stalled at the step when crossing over 1 step in the environment for each regime of genetic architecture simulated and across varying magnitudes of step height. Points are jittered for visualization.}
\label{fig:waittimes}
\end{figure}

We also investigated these same single step height scenarios for simulations having larger dispersal distances. A larger dispersal kernel with $\sigma_{disperse}$ doubled showed that expansion over a single step became more difficult. The same overall trend that higher mutation rates make expansion easier and possible over steeper steps is seen for larger dispersal distances, and the same qualitative result of the fourth genetic architecture regime again being able to more easily expand over a step that was more difficult under the third genetic architecture regime is recapitulated. The observed time stalled for replicates in these scenarios is presented in Supplemental Figure \ref{fig:waittimes200}.

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1\linewidth]{Figures/wait_times_200.pdf}}
\caption[Time spent stalled during step crossing.]{Time spent (in generations) stalled at the step when crossing over 1 step in the environment for each regime of genetic architecture simulated and across varying magnitudes of step height. Points are jittered for visualization.}
\label{fig:waittimes200}
\end{figure}


\subsubsection{Mutations contributing to adaptation across a step}

We conduct two analyses to examine if availability of mutations of different effect sizes is driving our result for a qualitative change in ability to adapt across a single step. %why expansion across steeper (taller) steps becomes more difficult as mutation rate decreases, but changes qualitatively again when large effect mutations are possible in the fourth genetic architecture regime. To investigate if this is due to the , 
First, we compare individuals existing below and above the environmental step in the mean numeric difference of their allelic state for each of the 100 loci underlying the QTL. This is done within 25 generations of when expansion successfully occurs in order to capture the effects directly contributing to adaptation in the new environment above the step. The allelic value at each locus is averaged across all individuals existing each above and below the step and within $40\times40$ cells of the step, and excluding the $2\times40$ closest cells subject to the strongest migration load. Comparing these values across the step thus shows the differences in effects that have accumulated on a per locus basis to allow these populations to adapt to these two different environments.

This comparison shows that as we increase the variance in mutational effect size, more differences per locus accumulate of larger effect sizes. Figure \ref{fig:effectsizes}a shows per locus effect size differences of up to 2.69 %2.688124
%(mean = 0.023) %0.02276596
for the fourth genetic architecture regime of large variance in mutational effect size, while those regimes with smaller variance in mutational effect size show smaller effects per locus down to a minimum of 0.010, spread across more loci (Table \ref{tab:effects}). 
%: $\mu = 10^{-4}$ and $\alpha^2 = 0.5$ maximum per locus difference of 1.14 %1.138611
%(mean = 0.018), % 0.01799473
%$\mu = 10^{-3}$ and $\alpha^2 = 0.05$ maximum per locus difference of 0.29 %0.286362
%(mean = 0.010), % 0.01029218
%$\mu = 10^{-2}$ and $\alpha^2 = 0.005$ maximum per locus difference of 0.46 %0.460336
%(mean = 0.019). % 0.01899583
%% I COULD SHOULD do stats on these differences
As the magnitude of difference in optimum across the step increases, the per locus effect sizes differences become larger within each regime that is successfully able to expand across the step. These differences become even more pronounced across genetic architecture regimes, where again the fourth regime generates the largest maximum difference above and below the step at few loci (Figure \ref{fig:effectsizes}). However, these large per locus differences only increase to the point at which these genetic architectures can no longer expand and adapt across the step into the new habitat ($h_{step} = 10$ and $h_{step} = 12.5$).


\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1.1\linewidth]{Figures/Arrange_EffectSizeFigs.pdf}}
\caption[Per locus effect size differences.]{Per locus effect size differences below and above the environmental step. Each count represents one locus from across all replicates of simulations that successfully expanded over the step. The leftmost bars extend to such high values that the plot is cutoff and the maximum value of each bar is written above.}
\label{fig:effectsizes}
\end{figure}


%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
\begin{table}[h]
\centering \footnotesize
\caption[Per locus effect size differences]{Per locus effect size differences across scenarios of genetic architecture regimes. The range from minimum to maximum is shown for each scenario, as well as the mean.}
\label{tab:effects}
\begin{tabular}{cp{0.15\textwidth}cp{0.2\textwidth}c}
Genetic architecture				&	Step height	&	Per locus difference: range (mean)  \\ \hline \hline
$\mu = 10^{-2}$; $\alpha^2 = 0.005$	& $5$	& $-0.0674 - 0.4603 ~ (0.0190)$	\\ 
							& $7.5$	& $-0.0993 - 0.4884 ~ (0.0321)$	\\ 
							& $10$	& $-0.3633 - 0.5311 ~ (0.0479)$	\\ 
							& $12.5$	& $-0.4187 - 0.5464 ~ (0.0583)$	\\ \hline
$\mu = 10^{-3}$; $\alpha^2 = 0.05$	& $5$	& $-0.0655 - 0.2864 ~ (0.0103)$	\\ 
							& $7.5$	& $-0.1233 - 0.7258 ~ (0.0277)$	\\ 
							& $10$	& $-0.4088 - 0.8786 ~ (0.0447)$	\\ 
							& $12.5$	& $-0.4308 - 0.6513 ~ (0.0596)$	\\ \hline
$\mu = 10^{-4}$; $\alpha^2 = 0.5$	& $5$	& $-0.0144 - 1.1386 ~ (0.01799)$	\\ 
							& $7.5$	& $-0.2206 - 2.6775 ~ (0.0251)$	\\ 
							& $10$	& No expansion	\\ 
							& $12.5$	& No expansion	\\ \hline
$\mu = 10^{-5}$; $\alpha^2 = 5.0$	& $5$	& ${-0.0055} - 2.6881 ~ (0.0228)$	\\ 
							& $7.5$	& $-0.1967 - 4.8746 ~ (0.0190)$	\\ 
							& $10$	& $-0.6236 - 6.4207 ~ (0.0522)$	\\ 
							& $12.5$	& No expansion	\\ \hline
\end{tabular}
\end{table}
%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>

\subsubsection{Constant $V_G$ versus constant $V_M$}

Our second analysis of the role of larger effect mutations in enabling adaptation and expansion across a single step in the landscape uses a subset of analyses where $V_G$, instead of $V_M$, is held constant. 
%To further investigate the role of larger effect mutations in enabling adaptation and expansion across a single step in the landscape, rather than maintaining a constant $V_M$ as all other comparisons have, we maintain a constant $V_G$. 
This is investigated across step heights of $h_{step} = 5, 7.5, 10, 12.5,$ and $15$ with a mutation rate, $\mu$ held constant from our fourth genetic architecture regime. From \citet{Lande:1975} and \citet{Johnson:2005}, $V_M = 2 L \mu \alpha^2$ and $V_G \approx 2 L \sqrt{\mu \alpha^2 V_S}$, where $L$ is the number of loci and $\alpha^2$ the variance in mutational effect size. Holding the mutation rate, $\mu$ constant at $10^{-5}$ and the width of the fitness function, $V_S$ at 7.5, as is constant in all simulations, we thus approximate a constant $V_G$ by altering $L$ and $\alpha^2$. We compare two cases to the case already presented above with 100 loci and $\alpha^2 = 5.0$: a scenario of 316 loci with $\alpha^2 = 0.5$ and a scenario of 1000 loci with $\alpha^2 = 0.05$. This further comparison confirms whether adaptation across the step is allowed by many loci of small effect or few loci of large effect. $V_G$ as estimated in the resultant simulations did vary across scenarios, but was within the same order of magnitude, ranging from around 0.02 for 100 loci up to 0.35 for 1000 loci (Supplemental Figure \color{red}XX\color{black}). 

\color{red} update these results when sims finish \color{black}
We found before that the case of 100 loci with $\alpha^2 = 5.0$ resulted in $19$ out of $20$ replicates successfully expanding over a step of height 10 after variable length of time stalled below the step. Step heights of $5$ and $7.5$ were quickly expanded over without stalling below the step. With more loci of smaller mutational effects, $0$ out of $10$ replicates for both 316 and 1000 loci expanded over a step of height $10$. With 316 loci and and $\alpha^2 = 0.5$, $4$ out of $10$ replicates expanded over the step of height $7.5$, with $3$ of those replicates stalling below the step before expanding. No cases for 1000 loci and $\alpha^2 = 0.05$ expanded over a step of height $7.5$ ($n = 10$). While at a step height of $5$, all replicates could again expand over the step without stalling below the step (Figure \ref{fig:constVG}). %%%% FILL IN 316 and 1000 loci results

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1.1\linewidth]{Figures/constVG_wait_times.pdf}}
\caption[Time to expansion with constant $V_G$.]{Time to expansion for scenarios of approximately constant $V_G$.}
\label{fig:constVG}
\end{figure}


\subsection{Combination of step height and step width}

The previous section showed which genetic architectures are able to expand over a single step of a given height. To further investigate the role of landscape heterogeneity in combination with genetic architecture, we investigate the ability of populations to expand across multiple steps of a constant height, for which expansion over a single step of the same height did occur. We know from a weak overall gradient, that expansion across heterogeneous step landscapes only broke down when the individual step height became too large ($h_{step} = 15$ as shown above), but we now investigate the role of step heterogeneity on steeper overall gradients. In these cases, a constant step height of 5 and 10 were each used across the landscape. We simulated cases between 4 and 1959 (linear) steps across the landscape, therefore increasing the overall gradient as more steps are present on the landscape (Figure \ref{fig:multistep}).

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1.1\linewidth]{Figures/UpdatedGrowthRatesByStep.pdf}}
\caption[Population growth rates across multi-step scenarios.]{Population growth rates across multi-step scenarios having either a constant step height of 5 or 10. The width of each step directly correlates to the number of steps on the landscape, and the overall gradient value for the landscape is equal to the step height times the number of steps.}
\label{fig:multistep}
\end{figure}

We find that for step heights of $5$, population growth rate decreases as more steps exist on the landscape. As shown from our previous investigations of linear gradients, constant step height of 5 on a linear gradient ($b = 5$) is too steep for expansion to occur. Immediately beyond this limit however, when each step is a width of two cells instead of one, expansion is again possible. With the larger dispersal kernel, the first occurrence of expansion is not until steps are of width three cells or greater. The point at which expansion no longer occurs is consistent across genetic architecture regimes for $h_{step} = 5$.

In the parameter space where expansion is possible, the rate of population growth differs across genetic architecture regimes, and undergoes a qualitative shift when the width of a step is around $14 - 20$ cells. Between step widths of $2$ ($3$ for large dispersal kernel) and $14 - 20$, the first genetic architecture regime of $\mu = 10^{-2}$ and $\alpha^2 = 0.005$ shows the slowest growth rates, yet switches to become one of the fastest growing scenarios when steps are wider than $20$ cells. The opposite is true for the third and fourth genetic architecture regimes which grow fastest out of all regimes between step widths of $2$ ($3$ for large dispersal kernel) and $14 - 20$, but are slower than the other regimes when steps are wider than 20 cells.

For step height of $10$, only two genetic architectures were investigated (first and fourth regime). %% ADD IN SECOND WHEN I CAN
Under the first regime, expansion succeeds when step widths are $3$ cells or greater for either dispersal kernel. However, for the fourth regime, expansion does not succeed until steps are of width $7$ or greater under the small dispersal kernel and 9 or greater under the larger dispersal kernel. There is no consistent switch in speed of these regimes with wider step widths, however the larger dispersal kernel is faster on wider steps for the first regime, yet slower for the fourth regime, up until the point of reaching a similar speed on the widest steps.

\subsection{Predicting expansion on heterogeneous landscapes \color{red}does this part make any sense?\color{black}}
% report something like ratio of width to height for expansion ability
The failure of $b_{crit}$ to predict successful expansion on a heterogeneous landscape leads us to derive a new predictor of expansion success. \color{red}this isn't really the black and white answer I would like, so maybe redo or take this out? \color{black} We calculate a weighted measure of the local gradient by dividing the height of steps across the landscape by the width of steps on the landscape, and multiply this value by $\sigma_{disperse}$ to calculate this new weighted gradient value. Conducting a simple linear regression on the relationship between the weighted gradient value and population growth rate finds this to be a significant predictor of growth rate ($R^2 = 0.604, p < 0.0001$) and therefore the likely success of expansion over the landscape (Figure \ref{fig:linearmodel}). Though populations that fail to expand do appear below the critical value predicted, the observed and predicted upper limits of a non-zero growth rate are similar.

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=0.7\linewidth]{Figures/LinearModel.pdf}}
\caption[Linear regression of weighted gradient on population growth rate.]{Linear regression of weighted gradient on mean population growth rate across all scenarios simulated in this study. Growth rates of zero are colored in red, while nonzero are colored in blue. The fitted line (solid) predicts a critical value for positive growth rate to be below $\sim3$ while the observed critical value for a positive growth rate (dashed, gray) is at $\sim2.6$.}
\label{fig:linearmodel}
\end{figure}

Performing the same regression analysis within each genetic architecture regime only improves predictive ability for one scenario, but decreases it from the overall model. For the first genetic architecture regime, the predicted critical value for no population growth equalled $2.59$ while the observed critical value was equal to $2.50$. The $R^2$ for this model increases to $0.627$ ($p < 0.0001$). The other three genetic architecture regimes produce $R^2$ values all less than $0.6$ and predicted critical values that overestimate the observed critical value for zero population growth (Table \ref{tab:linearmodels}).

%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
\begin{table}[h]
\centering \footnotesize
\caption[Linear regression for predicting expansion success]{Results from linear regressions for predicting expansion success in terms of population growth rate for all simulation means, and broken into each genetic architecture regime.}
\label{tab:linearmodels}
%\begin{tabular}{cp{0.25\textwidth}cp{0.25\textwidth}cp{0.4\textwidth}c}
\begin{tabular}{lccc}
Regression model				&	Observed critical value	&	Predicted critical value	&   \\ \hline \hline
All scenarios					& $2.590267$	& $2.988544$	&	$R^2 = 0.6043, p < 0.0001$	\\  \hline
$\mu = 10^{-2}$; $\alpha^2 = 0.005$	& $2.590267$	& $2.49886$	&	$R^2 = 0.6309, p < 0.0001$	\\  \hline
$\mu = 10^{-3}$; $\alpha^2 = 0.05$	& $2.079442$	& $3.5474$	&	$R^2 = 0.5873, p < 0.0001$	\\ \hline
$\mu = 10^{-4}$; $\alpha^2 = 0.5$	& $1.89712$	& $4.079371$	&	$R^2 = 0.5592, p < 0.0001$	\\ \hline
$\mu = 10^{-5}$; $\alpha^2 = 5.0$	& $2.079442$	& $2.721747$	&	$R^2 = 0.5888, p < 0.0001$	\\ \hline
\end{tabular}
\end{table}
%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>






\section{Discussion}


Our results have investigated two main questions: do predictions of range expansion from a linear gradient successfully extrapolate to heterogeneous gradients, and does the genetic architecture of a system impact the location of these critical gradient values. We find that predictions of range expansions from linear gradients do not fully extend to more heterogeneously changing environmental gradients. We also find that critical gradient values do depend on genetic architecture and whether small or large effect mutations are possible in the system. The interactions and effects of landscape heterogeneity and genetic architecture on determining adaptation and range expansion are important for understanding the ability of various species and taxa to react to climate change and successfully adapt to new environmental conditions. 

% move to end of discussion: In particular, sharp changes in environmental optima, as we examine, may be similar to changes in temperature which are predicted to increase in extremes and variability with climate change. Though we have investigated these changes in optima spatially, temporal changes may have

Previous studies have investigated range expansions across linear environmental gradients and the conditions for adaptation across the range or extinction \citep{Kirkpatrick:1997, Barton:2001, Bridle:2010, Polechova:2015}. Our simulation setup does not match to these studies in several ways, even on a linear gradient, hence we had no prior expectation for the predictions of a critical gradient value to closely match our observed critical gradient values for expansion. \citet{Kirkpatrick:1997} do not allow the genetic variance to evolve in their model which finds either unlimited range expansion below the critical environmental gradient or extinction above it. Allowing genetic variance to evolve in \citet{Barton:2001} predicts that expansion always successfully occurs on a gradient and no range limits are formed. However, the latest work from \citet{Polechova:2015} incorporated both evolving genetic variance and genetic drift, and range limits are found under certain parameter conditions. 

Applying the prediction for a critical gradient from \citet{Barton:2001} estimates critical values on a linear gradient that is much shallower than where our simulations show the limit to expansion occurring. This is likely due to several factors. One major difference in our simulations, even for the linear gradients, is that the core starting population exists in a region of constant phenotypic optimum, and only outside of this core does the environmental gradient begin. Populations are burned in and thus well-adapted to the landscape core before expansion becomes possible in the model. Once expansion is possible, extinction across the entire species range is not possible since the landscape core can always sustain despite the steepness of the gradient. This differs from prior studies which do not possess such a core and can collapse to extinction when existing entirely over a gradient. Therefore, in cases where a gradient may be too steep for a population to persist long enough in order to adapt is not an issue for our model because individuals dispersing from the core will continually be able to attempt adapting to the new environment throughout time without being subject to extinction. This may explain in part why we find much steeper critical gradient values at which expansion outside of the core fails. It is furthermore inaccurate to call this result a biological range limit in the same sense used by prior studies since this stable range boundary only exists as a product of the surviving core population.

A second, and perhaps more important, explanation for $b_{crit}$ predictions failing is due to their incorporation of the genetic variance, $V_G$, into calculating the critical value. Measuring $V_G$ in populations and using this value to predict adaptive ability is not unfounded, but our results have proved that $V_G$ alone is insufficient to characterize or predict adaptive ability and thus range expansions. It is known that increased $V_G$ is needed to successfully adapt to novel environments, and our results recapitulate this as can be seen on our heterogeneous, step landscapes where $V_G$ is greatly inflated at and around each environmental step in the landscape. Furthermore, it is known that $V_G$ evolves, which was also seen in our simulations. On steeper linear gradients, and steps of larger heights, equilibrium $V_G$ was much higher than for shallower gradients or smaller step heights (\color{red}I think there's going to be a supplemental figure on this\color{black}). Because $V_G$ can evolve, it is thus not a useful measure for predicting adaptive ability. Core populations' equilibrium genetic variances differed across our genetic architecture regimes, but once these simulations expanded onto gradients, $V_G$ evolved to similar values across regimes within a given gradient value.

%%we don't match bcrit expectations for several reasons
%%the major one begint hat there is no useful vg definition
%%it is defined on the landscape when it gets too steep
%%because vg can evolve

A useful aspect of knowing the genetic variance still remains, and that is its upper limit. Setting aside the effects of genetic architecture momentarily, we can see that the cases where expansion no longer succeeded are those for which $V_G$ became too large. Genetic variance that is too large results in a locally maladapted population as individuals are too different from their local phenotypic optimum. 

The idea that $V_G$ is the necessary measure of a population to predict its adaptive ability is however incomplete. We found a qualitative shift in the mechanism of adaptation and expansion across our genetic architecture regimes. The main driver of differing equilibrium $V_G$ was mutation rate, thus even when we hold $V_m$ constant, genetic variance decreased with decreasing mutation rates. This made expansion more difficult as the genetic material needed to adapt to new environments was reduced. However, the shift in our fourth genetic architecture regime whereby adaptation and expansion can again succeed, with increased time stalled below the step, suggested that larger effect mutations allow another path by which populations can adapt. From the subset of simulations performed with $V_G$ approximately held constant rather than $V_m$, we find that this does seem to be the case. At a given mutation rate, expansion was successful with fewer loci of larger effect, but more loci of smaller effect resulted in a shift back to the non-successful expansion regime. This alternative route for successful adaptation shows that $V_G$ alone is not a sufficient metric for prediction, and an understanding of genetic architecture and the potential for large effect mutations is key.

%% for our observed bcrit, we see differences among genetic architectures
%%shows that a certain amount of vg is required in order to successfully adapt to a new habitat
%%or that there is another regime of adaptation that depends on mutational input, and is slower but allows adaptation again on more steep landscapes


% LANDSCAPE ALSO MATTERED

Heterogeneity of the environmental gradient adds another major difficulty in predicting the success of range expansions. Using the critical gradient values observed in our simulations, within a genetic architecture regime, and applying these to predict expansion over heterogeneously changing landscapes breaks down as heterogeneity increases. 

A linear gradient is made up of what we could call very tiny steps happening all the time

our het gradients were fewer steps but changing more in magnitude each time

breaking down an overall landscape gradient like this lets us examine the causal factors for expansion

we find that both aspects, height of steps (magnitude of optimum change over one unit of space) and width of steps (how frequently they occur over the landscape) both affect the ability to expand

schiffers showed that patchiness mattered, but we also show that the magnitude of change of these patches matters


%% Schiffers: Using an individual-based allelic model, we explore the effects of different landscape structures on the rate of adaptation to novel environments and investigate how these structures interact with the genetic architecture of the trait governing adaptation and the dispersal capacity of the considered species. Generally, we find that rapid adaptation is favored by a good match between the coarseness of the traits genetic architecture (many loci of small effects versus few loci of large effects) and the coarseness of the landscape (abruptness of transitions in environmental conditions). For example, in rugged landscapes, adaptation is quicker for genetic architectures with few loci of large effects, while for shallow gradients the opposite is true. Moreover, dispersal capacities affect the rate of adaptation by modulating the apparent coarseness of the landscape: a gradient perceived as smooth by species with limited dispersal capacities appears rather steep for highly dispersive ones. We also find that the distribution of evolving phenotypes strongly depends on the interplay of landscape structure and dispersal capacities, ranging from two distinct phenotypes for most rugged landscapes, over the co-occurrence of an additional third phenotype for highly dispersive species, to the whole range of phenotypes on smooth gradients.

%% PICK UP HERE



to understand why adaptation does or does not succeed and when the bcrit prediction fails, looking at landscapes that are more heterogeneous within an overall gradient allows us to test whether it is the magnitude of change in optimum over space or the size of local habitat that limit adaptation and expansion



Schiffers found genetic arch to match grain of landscape, we find it also matches magnitude of change in optimum, but can also present two different mechanisms of expansion and adaptation that can take longer and depend on new mutations


one step analyses show height matters
need the mutations or standing variation to adapt

but making it over one step of a given height doesn't ensure that you can make it over multiple steps of that height
too many steps of a given height again prevents expansion
	
so step width also matters
	why?
	migration load from other steps
	need recovery that mig load prevents (local adaptation not possible)
		
	ratio of step width to step height that is the critical value
	or ratio of step width to total gradient that is the critical value?





multistep stuff heights 5 and 10
on height 5:
once steps are wide enough, about greater than width 14ish, the rank order of growth rate across gen arch changes
this is about the same for disp 200
gen arch 0.01 is slowest when there are lots of steps, then 0.001 then 0.00001, THEN 0.0001 fastest WHYYYY?
past that switch point when steps are plenty wide, 0.00001 is slowest, followed closely or matched by 0.0001

with the larger disp kernel, ability to expand stops sooner, at step width 2 growth rate is zero (3 can go) whereas on disp 100 all could still expand, just slowly on step width 1


on height 10:
only 2 cases expanded and growth rate approached zero much sooner (total gradient value of xx, step width of yy)

growth rate was higher for disp 200 in gen arch 0.01, but was almost the same for 0.00001, because in the latter case this supports our result of that growth depending on a mutation arising to get over a step, not on the distance able to be traveled and colonized, which is what drives it when expansion is easier in the other genetic architecture (orange squares versus plus signs)





\subsection{Impact of dispersal distances}

larger dispersal distances make everything more difficult (make sure this is true)

because more migration load


\subsection{Conclusions}

vg alone is not enough of a predictor
because genetic architecture matters
and mutation effect sizes matter

overall gradient is also not enough because we know the real world is more complex
and we find that this complexity can change the outcome of range expansion


%\section{Acknowledgements}
%We would like to thank Fred\'eric Guillaume for help with \textsc{nemo} and members of the Whitlock lab for comments and feedback.


%%% Local Variables:
%%% TeX-master: "thesis"
%%% TeX-PDF-mode: t
%%% End:
