\chapter{Genetic architecture and landscape heterogeneity impact adaptation during species range expansion}%The role of genetic architecture and environmental gradients in adaptation during range expansion}
\label{chap:heterogeneouslandscapes}

\section{Abstract}
Range expansions are complex evolutionary and ecological processes. From an evolutionary standpoint, understanding populations' adaptive capacity is a major factor in determining the success or failure of  expansion. Examining this ability to adapt over rugged landscapes that change heterogeneously in space is biologically important and not yet investigated by studies of range expansions. We investigate the role of heterogeneous environmental gradients and genetic architecture in terms of the outcome of species range expansion. We find that both of these factors impact adaptation and expansion over the landscape in contrast to previous studies' predictions over a linear environmental gradient. Different genetic architectures allow adaptation to newly encountered environments to proceed either via many genes of small effect or few of large effect, but the intermediate between these extremes makes adaptation most difficult. The structural layout of the landscape likewise impacts range expansion, where steeper gradients prevent expansion, but breaking a linear gradient into local patches with sharp changes in phenotypic optimum also increases the difficulty of adaptation and expansion.


\section{Introduction}

%discuss the question of adaptation broadly - it's important in many aspects of evolution
The ability for populations to adapt to novel environments has been studied in evolutionary biology for decades. Understanding populations' abilities to adapt to novel environments is key to understanding range expansions and is a major area of study across evolutionary biology in studies of speciation, local adaptation, invasive species, and conservation biology \citep{Stapley:2010, Sexton:2009}. Populations are known to locally adapt within their species range to survive across a range of disparate environments \citep{Kawecki:2004}, but why populations cannot always continue to locally adapt past a range edge and expand is unclear. The capacity for adaptation to new environments has important implications in determining the capacity of invasive species to thrive \citep{Prentis:2008} and the potential for success of new genetic diversity from attempts of assisted migration \citep{Aitken:2013}. 

% range expansions 
Adaptation during range expansions has been examined in great detail. Foundational theoretical work on adaptation and range expansions over environmental gradients has showed that, on a linear environmental gradient, increasing the steepness of change in environmental optimum leads to maladaptation at the margin and eventual extinction of the species \citep{Kirkpatrick:1997}. Further investigations have improved upon this model and shown the effects of density dependent selection \citep{GarciaRamos:1997} as well as stochastic effects on low density \citep{Bridle:2010}, temporal changes in environments \citep{Pease:1989}, differing dispersal parameters \citep{Aguilee:2012}, evolution of genetic variance \citep{Barton:2001,Polechova:2009}, and the impacts of genetic drift  \citep{Polechova:2015} on adaptation or the lack thereof at range margins. 

These studies have all investigated adaptation in models of linear environmental gradients in continuous space. Further theoretical studies have investigated adaptation across two disparate patches different environmental optima. \citet{Ronce:2001} showed that if selection is strong enough within each habitat or migration reduced enough, this can prevent the establishment of foreign alleles in a new population allowing it to adapt sufficiently to local conditions. Others have shown that evolutionary rescue from migration into marginal populations of small effective population sizes, which otherwise behave as sinks, can then reach a self-sustaining level, adapt, and persist \citep{Holt:1997,Gomulkiewicz:1999,Ching:2012}. The level of gene flow among populations can greatly affect the outcome for adaptation and range expansion. On a linear gradient, higher gene flow has been shown to introduce more maladaptive alleles from greater distances and thus be more detrimental to the local population \citep{GarciaRamos:1997}.

The structure of a landscape relates to the effects of gene flow in adapting to the local environment. These previous studies have investigated range expansions over linear gradients and adaptation across two patches in space, but the intermediate situation of environments that change heterogeneously over space adds necessary biological realism. Real world environments are often more complex than linear gradients of environmental change. Environments are heterogeneous and can change in multifarious ways over space, from gradual to sudden, and of minor or major magnitudes of change over space. Species are known to exist across continuous gradients, for example temperature changes latitudinally across many species ranges (\color{red}citations\color{black}). Changes in temperature or other environmental variables that populations must adapt to can occur more heterogeneously in space as well \citep{Pickett:1997}, for example with bioclimatic regions, patches of forest or meadow, elevational gradients with distinct regions of environments such as above or below the timberline, or changes in soil conditions along slopes. Lastly, species are also known to exist across scenarios similar to two-patch models, for example plants living on and off patches of serpentine soils \citep{Brady:2005}. These differences in landscape structure play a key role in the process of populations adapting because of their potential to interact with the effects of evolutionary processes at the range margin. We can thus hypothesize that heterogeneous landscapes may potentially change outcomes of adaptation beyond expectations from either of these previous models. 

When discrete habitat types exist contiguously across space, it is not known if the dynamics will reflect those of the continuous linear gradient or the discrete models. \citet{Barton:2001} suggested the ability of populations to persist across environments of accelerating gradients, but in depth examination of different types of environmental heterogeneities is warranted. \citet{Schiffers:2014} have investigated the role of adaptation across two habitat types distributed in patches over the environment, and found that the coarseness of environmental change must match the coarseness of the system's genetic architecture. This study did not extend into investigations of environmental heterogeneity over a large-scale gradient. With larger environmental differences in optima, it is not known if large effect mutations are needed to contribute to local adaptation or if many small effect alleles can still lead to successful adaptation across a species range.

%% I haven't really said much about expansions at all in the intro...
When considering environmental heterogeneity in terms of adaptation during range expansions, there are several important genetic processes that can lead to interesting hypotheses for adaptation across the landscape, making range expansions ideal for studying the combination of these effects. The characteristics of the environment available for a species to expand into plays an important role in the ability of populations to expand \citep{Aguilee:2012, Barton:2001, Pease:1989}. Increasing habitat heterogeneity, and thus heterogeneity in selective pressures, interacts with gene flow to influence the adaptive abilities of peripheral populations, and can in some cases inhibit local adaptation in peripheral populations \citep{Slatkin:1987,Kirkpatrick:1997, Ronce:2001}. When gene surfing occurs during range expansions, it is also possible for neutral processes to alter allele frequencies at the range edge in directions opposed to those of selection for local adaptation \citep{Klopfstein:2006, Peischl:2013, Peischl:2015, Excoffier:2009}. Due to reduced density at range margins, edge populations experience gene flow at much higher proportions than populations existing within the denser core of the species range. This asymmetric migration can behave in two disparate ways: introducing new genetic variation needed for further adaptation in an otherwise genetically depauperate population, or swamping locally adaptive alleles with foreign maladaptive alleles thus preventing further adaptation. Which of these occurs will depend on the details of migration rates, mutation rates, population sizes, and the degree to which the environment differs across the species range.



% talk about genetic architecture
Another major aspect of studying the ability for populations to adapt is understanding which and how many genes contribute to local adaptation \citep{Stapley:2010}. Many studies, both empirical and theoretical, examine genetic architecture and its role in the ability to adapt to a novel environment \citep{Yeaman:2015, Yeaman:2011, Carroll:2001, Holloway:1990, Peichel:2001, Bratteler:2006, Schiffers:2014}. It is known that a sufficient level of genetic variation, $V_G$, is necessary to provide the alleles required for adapting to a new environment. It was previously thought that many alleles of too small an effect may be swamped by gene flow before being able to contribute to sufficient local adaptation, but as shown by \citep{Yeaman:2015}, %% MCW: you need Lecorre and Kremer references in here too
local adaptation via many genes of small effect is possible. This occurs through transient processes subject to random genetic drift when rates and sizes of mutations and genetic redundancy are sufficient (though detecting the presence of such alleles remains a difficult task). It is clear however, that fewer loci of larger effect can contribute best to adaptation, which eventually lead to the building up of linked clusters of locally adapted alleles, often referred to as genomic islands of divergence \citep{Feder:2010}. Empirical studies have also substantiated evidence for adaptation via many loci of small effect \citep{Buckler:2009}. Even when small effect alleles may initially contribute to adaptation, larger effect alleles accumulate over time and contribute to adaptive differences among populations \citep{Yeaman:2011}. As \citet{Renaut:2013} have shown in sunflower species, genetic architecture plays a larger role in contributing to genomic divergence of species than does the level of geographic isolation for speciation. \color{blue}The details of genetic architecture are thus vital in studies of adaptation, and should not, nor need not, be ignored in today's era of genomic technologies\color{black}. % eh, maybe remove the last part here, I am only doing a simulation study after all
Incorporating investigations of various types of genetic architecture into studies of range expansions may have broad implications for understanding how species will be able to adapt and cope with global climate change. 
% talk about range expansions over linear gradients



In this study, we address two main questions. First, do predictions of range expansion from a linear gradient successfully extrapolate to a heterogeneous gradient. And second, does the genetic architecture of the system impact where these critical gradients exist for the success or failure of range expansion. We extend the model of \citet{Schiffers:2014} to a much larger scale of species range expansions to test if different genetic architectures and landscape heterogeneities can interact and affect the outcome of adaptation during a species range expansion. We simulate range expansion across a spatially explicit and discrete two-dimensional landscape with individual-based, forward time simulations in the program \textsc{nemo} \citep{Guillaume:2006}. We vary two main parameters of interest: the heterogeneity of change in environmental optimum in space and the genetic architecture underlying the quantitative trait that allows adaptation to the local environment. We model a range of genetic architectures for a quantitative trait to examine potential differences in ability to adapt to environments that change heterogeneously in space. Examining the rate of range expansion and the time required for populations to colonize and adapt in new environments provides insight into the role of both genetic architecture and environmental heterogeneity in determining the success or failure of adaptation across a species range. 

%%Our goal is to understand the impact and interactions of genetic architecture and the landscape heterogeneity over which individuals exist in terms of the outcome of range expansion and population adaptation.



 %%Such results are highly informative for the field of evolutionary biology, and largely applicable in predicting the fate of many species across the globe requiring the ability to adapt in the face of disturbance and shifting species ranges due to climate change and other anthropogenic environmental perturbations.





%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>

% marginal populations thus often exist only as a sink, sustained by immigration until sufficient local adaptation is achieved. % and recovery from expansion load? -- refer to Ch 4 here, i.e. refer to our group project paper -- or just talk less about load since I'm not studying it in this paper
% When the population shifts to be a self-sustaining source, it escapes the effects of drift, and provides emigrants for further colonization and range expansion. This shift from sink to source also includes a shift away from asymmetric migration previously swamping locally adaptive alleles with foreign maladaptive alleles.

%Local adaptation within a species not only benefits populations in terms of fitness but also has repercussions for a species' global range. A species' range is defined in some cases by sharp visible boundaries, such as distinct geographical changes in landscape features, or equally understandable ecological reasons such as competitor occurrence or nutrient limitations. In instances where no such clear reason for a range edge exists, understanding what forces limit expansion and adaptation at the edge of a range becomes an evolutionary question \citep{Bridle:2007,Kawecki:2008,Excoffier:2009}. Barriers to dispersal may prevent expansion past the edge, however gene flow can also act to inhibit local adaptation in peripheral populations \citep{Slatkin:1987,Kirkpatrick:1997}. This, in combination with different selective forces from environmental gradients across the landscape, may prevent expansion. The characteristics of the environment available for a species to expand into plays an important role \citep{Aguilee:2012,Barton:2001,Pease:1989}. Increasing habitat heterogeneity, and thus heterogeneity in selective pressures, interacts with gene flow to influence the adaptive abilities of peripheral populations \citep{Ronce:2001}.

% Under one of the first models to examine the question of adaptation across species ranges \citep{Kirkpatrick:1997}, it was shown that three different scenarios could result: species extinction, a limited species range, or unlimited expansion of a species. Other studies have examined scenarios similar to this model and incorporated more realistic simulation methods that were previously not investigated: density dependent selection \citep{GarciaRamos:1997,Gomulkiewicz:1999} as well as stochastic effects on low density \citep{Bridle:2010}, temporal changes in environments \citep{Pease:1989}, differing dispersal parameters \citep{Aguilee:2012}, and evolution of genetic variance \citep{Barton:2001,Polechova:2009}. \citet{Case:2000} also incorporated species competition, under which they found similar results only with a shallower environmental gradient needed to limit range expansion. Some of these models use the same linear gradient of an environmental optimum changing at a constant rate over continuous space, while others simulate adaptation to differing environmental optima across discrete space (habitat patches) within which  individuals of a patch possess no explicit spatial designation. The results of these discrete environment models also show the potential for species to either adapt and persist, exist as non-adapted generalists, or go extinct.

%Equally relevant to studying adaptation in a local adaptation or speciation context, is the study of adaptation during a species range expansion. As a species range expands, it encounters novel habitat to which it must adapt. Previous studies have shown that it is the ability of populations at range edges to adapt to these new environments that can determine the ability of a range to expand (citations). Not unlike parapatric speciation, this adaptation to new environments must occur in the presence of gene flow. Asymmetric gene flow at a range edge, however, can cause migration load that is particularly strong when an edge population is still a sink and requiring the influx of individuals to persist.

%Species range limits and the capacity for range expansion has long been a question in evolutionary biology. A species' range is defined in some cases by sharp visible boundaries, such as distinct geographical changes in landscape features, or equally understandable ecological reasons such as competitor occurrence or nutrient limitations. In instances where no such clear reason for a range edge exists, understanding what forces limit expansion and adaptation at the edge of a range becomes an evolutionary question \citep{Bridle:2007, Kawecki:2008, Excoffier:2009}. Barriers to dispersal may prevent expansion past the edge, however gene flow can also act to inhibit local adaptation in peripheral populations \citep{Slatkin:1987, Kirkpatrick:1997}. This, in combination with different selective forces from environmental gradients across the landscape, may prevent expansion. 


%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>



\section{Methods}

We implement a modified version of \textsc{nemo} \citep{Guillaume:2006}, described in Gilbert \emph{et al.} (\Chapref{expansionload}), which allows continuous space to be approximated by a discrete, two-dimensional species range. This expands greatly upon existing 2-patch models with non-explicit space within each landscape patch and approaches a model of continuous space. Individuals are monoecious (hermaphroditic), obligately outcrossing diploids which possess a quantitative trait under balancing selection for the local environmental optimum. We initiate the population in a limited region for a burn-in to migration-mutation-selection equilibrium, after which populations expand into empty landscape of various types of heterogeneous environmental optima. Generations are non-overlapping and life cycle events occur in the order of breeding, dispersal, viability selection, and population regulation. We monitor the populations' abilities to spread across the landscape, and when successful, compare these scenarios in terms of expansion speed and fitness as they encounter environments of differing environmental optima to which they must adapt in order to further expand.

\subsection{Landscapes}

To approximate continuous space and maintain a spatially explicit landscape with discrete populations, we implemented a large spatial grid of habitat patches in \textsc{nemo}. This bridges the gap between existing two-patch landscape models, where existence within either of these two patches is not spatially defined, and models of continuous space. The landscape is a rectangular grid of $40\times2000$ cells with a defined phenotypic optimum and carrying capacity for every cell in the landscape. We term the leftmost $40\times40$ cells of the landscape the core, which is where the burn-in period occurs. After burn-in, expansion proceeds along the long ($x$) axis of the landscape into the remaining $40\times1960$ cells. The core consistently possessed a constant optimum phenotypic value of $0$ to ensure that the population was well-adapted before populations expanded onto environmental gradients. In all cases, the environmental optimum only changed in one dimension over the axis of expansion ($x$-axis) and was constant over cross-sections of the landscape ($y$-axis). We thus average all values across the $40$-cell $y$-axis into a single value for a cross section at each location $x$ on the landscape. Terms for describing these landscape and other parameters are defined in Table \ref{tab:params}.

%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
\begin{table}[h]
\centering \footnotesize
\caption{Terminology and parameter definitions for simulations}
\label{tab:params}
\begin{tabular}{lp{0.8\textwidth}l}
Term			& Explanation  \\ \hline \hline
Cell			& One square unit on the landscape grid. The entire landscape is $40\times2000$ cells.		\\ \hline
Cross section	& $40$ cells across the$y$-axis of the landscape.									\\ \hline
Core			& The leftmost $40\times40$ cells, equivalently the leftmost $40$ cross sections on the landscape. The population is limited to this region during the burn-in period. Environmental optimum is constant within the core.	\\ \hline
Patch		& A region of cross sections for which the phenotypic optimum on the landscape is constant.			\\ \hline
$\Delta z_{opt}$	& The magnitude of change in the optimum phenotypic trait, $z$, between cross sections on the landscape.			\\ \hline
\emph{K}		& Carrying capacity of a cell. Population regulation occurs at the level of cells. $K = 5$ in all cases.		\\ \hline
$\sigma_{breed}$ & One standard deviation of the Gaussian kernel describing the area of the breeding window. Individuals can find mates within cells contained by the breeding window. $\sigma_{breed} = 0.5$cell widths in all cases. \\ \hline
$\sigma_{disperse}$ & One standard deviation of the Gaussian kernel describing the area of potential dispersal. Offspring can disperse to cells within the dispersal kernel. $\sigma_{disperse} = 2$cell widths or $4$cell widths as described in the text.
\end{tabular}
\end{table}
%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>


We examined several types of environmental heterogeneities across landscapes. These range from a linear gradient to two patches, as well as combinations in between having multiple patches of constant environmental optima interspersed by sharp changes in the environment. We model landscapes of heterogeneous environmental gradients possessing patches of constant phenotypic optima interspersed by changes in phenotypic optima over the landscape. 

To define each type of heterogeneous landscape, we describe three parameters: the number of changes in environmental optima over the landscape, the magnitude of each of these changes, and the total gradient value across the landscape, which can be calculated from the previous two values. The total gradient value, $b$, on the landscape is measured as the total change in phenotypic optima over the landscape divided by the length of the landscape (measured by number of cross sections, 1960). We refer to each local change in environmental optima on the landscape as $\Delta z_{opt}$. This value measures the magnitude of change in phenotypic optima between two patches. Patches are defined as a contiguous region of cross sections for which the phenotypic optima is constant on the landscape. The number of number of times that $\Delta z_{opt}$ changes over the entire landscape is equal to the number of patches minus $1$. Figure \ref{fig:stepschematic} shows a schematic for a simplified landscape. A linear gradient simulated with our continuous approximation is thus the case where there are $1960$ patches on the landscape, each with a width of one cross section. 

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=0.9\linewidth]{Figures/StepSchematic_Figure.pdf}}
\caption[Schematic of heterogeneous landscapes.]{Schematic of simplified heterogeneous landscapes, where $\Delta z_{opt}$ is the magnitude of change in phenotypic optimum at one location on the landscape and patch size is the number of cross sections contained within a given area of the same environmental optimum. Landscapes depicted with solid lines have the same $\Delta z_{opt}$, but different total gradients, $b$, while the dashed and gray lines show the same overall gradient consisting of different numbers of patches with different $\Delta z_{opt}$s. The landscape core in the first $40$ cross sections of the landscape is constant, and the linear gradient is where there is a new patch at every unit $x$ on the landscape outside of the core.}
\label{fig:stepschematic}
\end{figure}


% maybe move to results
The steepness of a linear gradient at which range expansion is no longer possible is referred to as $b_{crit}$ \citep{Kirkpatrick:1997, Barton:2001, Bridle:2010}. We first model linear gradients to determine the critical value, $b_{crit}$ for which expansion could no longer occur. From this we then break down this linear gradient into steps of environmental change to test at what point this prediction of $b_{crit}$ fails to identify successful expansions. This held the total gradient value constant, but changed the frequency of steps and thus also each step's height. In these cases, the gradient, $b$, is measured for the overall slope of the landscape. To understand why this $b_{crit}$ prediction fails, we then investigate the role of step height alone on a two-patch landscape, and then elucidate the interaction of step height with step width in allowing adaptation and expansion to proceed across the landscape. All results present  the average value for a given parameter across the $y$-axis of the landscape for any given landscape location $x$. 


\subsection{Breeding \& Dispersal}
%%  reword this to focus on the discrete representation of a continuous dispersal kernel.  It is not to maintain a larger NE, but to mimic continuous space
The large landscape grid allows regulation for subpopulations at a fine scale across the landscape, which is what allows our simulations to approach a continuous spatial model. Each landscape cell has a carrying capacity set at $K = 5$. Breeding and dispersal both occur in windows over regions of nearby cells, maintaining populations at larger effective population sizes. Neighborhood size is approximately $250$ individuals, as calculated from \citet{Wright:1946}. 

The breeding window we introduced into \textsc{nemo} defines a given radius of cells around a focal cell from which an individual can find a potential mate during the breeding life cycle stage and is described in detail in Gilbert \emph{et al.} (\Chapref{expansionload}). Because modeling a range expansion implies that there will often be lone colonists on the expansion front, this addition of a breeding window increases biological realism by allowing lone colonists on the range front to still potentially find a nearby mate, even if they are the sole inhabitant of their cell. This most closely resembles obligately outcrossing plants, who may receive pollen from nearby mates, but could also represent animals that search for mates nearby then return to their home territory or scenarios where females are resident with roaming males. The probability a female mates with a given individual within her breeding window is described by an approximate bivariate Gaussian function. The size of this breeding window is defined by one standard deviation of a Gaussian distribution, $\sigma_{breed}$, where $f(x,y) \propto \exp{[-(\frac{\Delta x^2}{2\sigma_{breed}^2}+\frac{\Delta y^2}{2\sigma_{breed}^2})]}$ gives probability of mating with an individual at a given distance $x$ and $y$. We discretized these probabilities by integrating the probability over each cell and assigning each potential mate within the window a chance to father offspring proportional to its distance. $\sigma_{breed}$ was set at one half of a cell width, and the maximum search radius for a mate was limited to $4\sigma_{breed}$. This produced a breeding window containing the $13$ cells: the focal cell and its $12$ surrounding cells. Individual fecundity was drawn from a Poisson distribution with mean $4$ to determine the number of offspring to be produced.

Dispersal occurred similarly to breeding, where a dispersal kernel was defined for forward rates of migration and discretized over cells on the landscape. This distribution was defined by $\sigma_{disperse} = 2$cell widths for the majority of simulations. Where specified, a larger dispersal kernel of $\sigma_{disperse} = 4$cell widths was implemented. An R wrapper package was created to calculate breeding and dispersal kernels, and to discretize these probabilities across the landscape, and is available online at https://github.com/kjgilbert/aNEMOne. C++ code for the modified version of \textsc{nemo} with a breeding window is available online at https://github.com/kjgilbert/NemoDispersalKernel.

 
\subsection{Viability Selection}
Throughout the simulations, selection occurs only on survivorship, and not fecundity. Selection is stabilizing for the local environment's phenotypic optimum, with fitness of an individual defined by $w_z = exp[-\frac{(z-z_{opt})^2}{2 \omega^2}]$, where $z$ is the quantitative trait value, $z_{opt}$ is the optimum phenotypic trait for a given cell on the landscape, and $\omega^2$ defines the width of the fitness function. We scale phenotypic units in terms of environmental variance. With environmental variance, $V_E$, set to $1$, there is evidence that a heritability of $\sim\frac{1}{3}$ is calculated to give $\omega^2$ equal to $7.5$. This is derived fully in Gilbert \emph{et al.} (\Chapref{expansionload}), as follows from \citet{Kingsolver:2001, Johnson:2005, Mousseau:1987, Houle:1992}. 


\subsection{Genetic Architecture}
Individuals possess a quantitative trait that experiences balancing selection to adapt to the local environment. The quantitative trait, $z$, is controlled by 100 freely recombining loci. We held the total mutational variance, $V_m$, available to the system constant at $10^{-2}$, but varied the underlying genetic architectures contributing to the mutational variance. The number of loci, $L$, was also held constant at 100, thus to satisfy $V_m = 2 L \mu \alpha^2$ \citep{Lande:1975}, we varied the per locus mutation rate, $\mu$ and the variance in mutational effect sizes, $\alpha^2$. Four regimes of genetic architecture were investigated that range from high mutation rate and low variance in mutational effect size to low mutation rate and high variance in mutational effect size. Regime one set $\mu = 10^{-2}$ and $\alpha^2 = 0.005$, regime two set $\mu = 10^{-3}$ and $\alpha^2 = 0.05$, regime three set $\mu = 10^{-4}$ and $\alpha^2 = 0.5$, and regime four set $\mu = 10^{-5}$ and $\alpha^2 = 5.0$. We will call regime one the ``small effect mutations" scenario, regime two ``medium-small effect", regime three ``medium-large effect", and regime four ``large effect" mutations. Though the large effect regime has the potential for mutations of much larger effect sizes, small effect mutations are not excluded. \color{red}(edit this part when the constant Vg runs finish) For a subset of simulations, we also compared the effect of holding $V_G$ constant. This was done by holding $\mu$ constant at $10^{-5}$ and only varying $\alpha^2$ at $5, 0.5$, and $0.05$.%%According to \citet{Johnson:2005}, $V_G \approx 2 L \sqrt{\mu \alpha^2 V_S}$, thus we held $\mu$ constant at $10^{-5}$ and varied $L$ and $\alpha^2$ at $L = 316$ and $\alpha^2 = 0.5$, and $L = 1000$ and $\alpha^2 = 0.05$. This produced very similar levels of genetic variance in the landscape core with only slight variations of $V_G$ increasing with more loci (Supplemental Figure . ). 
\color{black}
%% re johnson and barton ref - MCW: But not necessarily in a spatial context, so re-word a bit.  This is not the Vg that we get in the burn-in, is it? If so, say that t worked.


\subsection{Analyses}

We quantify our results with two main measures: the growth rate of the entire metapopulation on the landscape and the time at which populations remain stationary before expanding into a patch they have encountered. Growth rate provides the most accurate measure of populations moving across the landscape within the confines of \textsc{nemo} and is further useful because it correlates closely to population fitness. The faster that populations expand, the higher their fitness is during this expansion. Away from the expanding front and any patch boundaries, populations exist at carrying capacity, so local density differences do not bias this measure of expansion rate.





 

\section{Results}


\subsection{Expansion on a linear gradient}

We first investigated the critical steepness for expansion on a linear gradient, $b_{crit}$. This $b_{crit}$ value varied depending on the genetic architecture modeled. The small effect and large effect regimes showed the highest $b_{crit}$ values, while both medium effect regimes had lower $b_{crit}$ values. The medium-large regime had the lowest $b_{crit}$ value of all genetic architectures modeled (Figure \ref{fig:linearspeed}). In all cases, as the steepness of the gradient approached $b_{crit}$, the rate of population growth decreased, indicating longer times to expand across these gradients. In the large effect regime for the steepest gradient on which expansion occurs ($b = 4$), only 2 replicates out of 10 expanded over the landscape to produce the calculated growth rate. These two replicates also did not immediately expand after the end of the burn-in, as did all other cases, but instead did not grow beyond the core until $8300-13200$ generations later. A similar phenomenon was observed for the medium-large regime, where populations again required additional time after burn-in before expansion across the landscape occurred. In these cases, expansion began for all replicates within $4850$ generations (range $= 575-4850$, mean $= 2487.5$ generations). The total population size maintained across the landscape as well as average fitness were also lower as gradient steepness increased towards $b_{crit}$ (\color{red}Supplemental Figure of pop sizes and or fitness.\color{black} ).

\citet{Barton:2001} derives predictions for the value of $b_{crit}$, which depend on the genetic variance: $b_{crit} = \frac{V_G}{\sigma \sqrt{V_S}}$, where $\sigma$ is the standard deviation of distance travelled by combining both gamete and offspring dispersal, i.e. $\sigma = \sqrt{\sigma_{disperse}^2 + \frac{1}{2}\sigma_{breed}^2}$. We find that the genetic variance across the landscape increases in scenarios of steeper environmental gradients (\color{red}Supplemental Figure . \color{black}). Because the genetic variance evolves differently on each gradient, this is not a useful $b_{crit}$ value for our simulations. We can calculate a $b_{crit}$ value using the genetic variance from the landscape core, but doing so creates large underestimate of our realized $b_{crit}$ values ($b_{crit} \approx 0.161, 0.125, 0.018,$ and $0.002$ for each genetic architecture respectively: small, medium-small, medium-large, and large). There are multiple reasons for this disparity in $b_{crit}$, which we consider in the Discussion.

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=0.6\linewidth]{Figures/GrowthRateZoomedIn.pdf}}
\caption[Growth rate of populations expanding over a linear gradient.]{Growth rate of populations expanding over a linear gradient, from $b = 1$ to $b = 5$ and for the small ($\sigma_{disperse} = 2$) and large ($\sigma_{disperse} = 4$) dispersal distances. The four different regimes of genetic architecture are indicated along the $x$-axis, and points are jittered. Below the gray dashed lines are cases that the population did not expand out of the core. Error bars indicate 95\% confidence intervals.}
\label{fig:linearspeed}
\end{figure}

For the same gradient values and genetic architectures, we examined the impact for dispersal distances to assess the ability for range expansion and the value of $b_{crit}$. The predicted $b_{crit}$ for these scenarios is $\approx 0.082, 0.063, 0.009,$ and $0.0008$, respectively; values which are approximately half of the predictions for the smaller dispersal kernel. Our realized $b_{crit}$ values in these larger dispersal cases again much larger than the predicted value using $V_G$ as estimated in the core, but were also much smaller than each respective $b_{crit}$ for the smaller dispersal cases (Figure \ref{fig:linearspeed}).	


\subsection{Expansion over heterogeneous landscape gradients} %% MCW: All gradients are heterogeneous.  How about discrete gradients?

%% Our measured $b_{crit}$ values define the slope of change over the environment on a linear gradient, but this gradient can consist of local heterogeneity while still overall possessing the same value of $b$ as measured across the entire landscape. This next set of simulations examines if and when the prediction from our measured $b_{crit}$ for each genetic architecture regime fails to describe the outcome of range expansion when we vary the degree of heterogeneity of change over the landscape. %% MCW: I'd say forget about measured bcrit and just talk about how bcrit changes with more discreteness

%% try to shorten this paragraph
We now examine how the outcome of range expansion changes as landscape heterogeneity changes. We model two values of $b$ ($b = 0.0075$ and $b = 0.015$), both of which create a very weak linear gradient for which expansion is easily successful. Holding this total gradient constant, we decrease the number of patches across the landscape at a range from $1960$ (linear) to $2$ and increase $\Delta z_{opt}$. Within a given simulation, $\Delta z_{opt}$ is constant, but across simulations $\Delta z_{opt}$ varies as the number of patches varies. 

On the weaker gradient ($b = 0.0075$), expansion occurs in all cases except the two patch model ($\Delta z_{opt} = 15$). One replicate did expand in this scenario for the medium-small regime after a $10000$ generation delay, but none of the remaining 79 replicates succeeded in expanding into a second patch with this value of $\Delta z_{opt}$. On the stronger gradient ($b = 0.015$), \color{red} fill these results in and add the figure \color{black} The steepness of the gradient, $b$, thus does not successfully predict expansion on non-linear, heterogeneous gradients. This leads us to test if $\Delta z_{opt}$ can predict expansion.


\subsection{Expansion in a two patch model}

We examine the ability of each genetic architecture to expand in a two patch model for a range of $\Delta z_{opt}$ values between the patches. The steepest $\Delta z_{opt}$ ($15$) matches the $\Delta z_{opt}$ in the previous section's weak gradient two-patch model. We find a pattern similar in the two patch models to that on the linear gradients for the ability of each genetic architecture to successfully expand (Figure \ref{fig:waittimes}). The small effect regime can cross a steep $\Delta z_{opt}$ ($12.5$), but requires time beyond the end of the burn-in to adapt and expand into the second patch. The medium-small regime has more difficulty at this value of $\Delta z_{opt}$, with only 3 of 20 replicates succeeding, and the medium-large regime does not expand at this or the next smallest $\Delta z_{opt}$ value ($10$). However, the large effect regime shows a qualitative change in its expansion ability by being able to cross a $\Delta z_{opt}$ that the medium-large regime could not. This expansion ($\Delta z_{opt} = 10$) requires time beyond the end of the burn-in to adapt and expand (Figure \ref{fig:waittimes}). The same trend is seen with a larger dispersal distance, where increased dispersal makes expansion more difficult at the same values of $\Delta z_{opt}$ (Supplemental Figure S\ref{fig:waittimes200}).


\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1\linewidth]{Figures/wait_times.pdf}}
\caption[Time spent before expansion into second patch.]{Time spent (in generations) before expansion into second patch for each genetic architecture regime. Points are jittered for visualization. All points beyond the vertical dashed line are censored and did not expand during the course of the simulation.}
\label{fig:waittimes}
\end{figure}


\subsubsection{Mutations contributing to adaptation between patches}

We examine potential mechanisms for this qualitative change occurring across genetic architectures. First to understand the effect sizes of mutations contributing to adaptation in the second patch, we compare genotypic values of individuals in each patch near the boundary of the patches. Though we do not have the ability to track specific mutations, this analysis allows us to assess if few, large-effect mutations may have occurred at specific loci and contributed to adaptation in the second patch. To measure this, we take individuals present within $42$ cross sections on either side of the boundary between patches. We ignore individuals in the closest two cross sections, as these are most strongly subject to gene flow across the patches. In each of the two $40$ cross sections, we calculate the mean genotypic value across all diploid individuals, i.e. the numeric value of each allele at a given locus, resulting in $100$ locus values. In order to capture the effects directly contributing to adaptation in the new patch, this was done within $25$ generations of expansion, as determined by population size in the second patch. The pairwise difference between the two patches for these $100$ locus values are shown for all replicates that successfully expanded into the second patch in Figure \ref{fig:effectsizes} and numeric values listed in Supplemental Table \ref{tab:effects}.

In all cases of $\Delta z_{opt}$, we can see that the large effect regime contains the largest per-locus differences between the patches, and the medium-large regime the second-most. As $\Delta z_{opt}$ increases, expansion no longer succeeds in the medium-large regime, and the large effect regime produces more and greater magnitude differences between the patches (Figure \ref{fig:effectsizes}).

% regime 4 max locus difference: 2.688124, (mean = 0.02276596) 
% regime 3 max locus difference: 1.138611 (mean = 0.01799473)
% regime 2 max locus difference: 0.286362 (mean = 0.01029218)
% regime 1 max locus difference: 0.460336 (mean = 0.01899583)
%% SHOULD I do stats on these differences

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=0.5\linewidth]{Figures/effect_sizes.pdf}}
\caption[Per locus genotypic differences.]{Per locus genotypic differences between patches in the two patch model. Each count represents one locus from across all replicates of simulations that successfully expanded into the second patch. Bars extending beyond the limit of the $y$-axis reach variable large values and are truncated to focus on the large effect differences. For 20 replicates and 100 loci, the counts for each color sum to 2000, and there are many small effect differences across loci in the truncated bars.}
\label{fig:effectsizes}
\end{figure}



\subsubsection{Constant $V_G$ versus constant $V_M$}

To examine if the amount of genetic variance, instead of mutational effect sizes drives the ability for populations to expand and adapt, we analyze a subset of simulations that held $V_G$ constant instead of $V_M$. 
%
\color{red} update these results when sims finish \color{black}
%
 With a decreasing $\alpha^2$, expansion became more difficult and only occurred for lower values of $\Delta z_{opt}$ (Figure \ref{fig:constVG}). This shows that genetic variance was not the determining factor for expansion in these cases, but that the availability of mutations of larger effect determined the ability to adapt and expand into the second patch. %%%% FILL IN 316 and 1000 loci results - AND NEW CONST VG RESULTS!!!

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1.1\linewidth]{Figures/constVG_wait_times.pdf}}
\caption[Time spent before expansion into second patch for constant $V_G$ simulations.]{Time spent (in generations) before expansion into second patch for each genetic architecture regime for simulations with constant $V_G$. Points are jittered for visualization. All points beyond the vertical dashed line are censored and did not expand during the course of the simulation. Mutation rate, $\mu$ was held constant at $10^{-5}$ while $\alpha^2$ was varied at \color{red}these values\color{black}.}
\label{fig:constVG}
\end{figure}


\subsection{Combination of patch size and $\Delta z_{opt}$}

We have thus far shown that overall $b$ matters for range expansion, but also that breaking this overall gradient into patches can change the outcome of expansion. $\Delta z_{opt}$ alone directly impacts the outcome of expansion, but when the overall $b$ fails to predict expansion, is $\Delta z_{opt}$ a sufficient determinant of range expansion? We now investigate the ability of populations to expand across multiple patches of a constant $\Delta z_{opt}$, using a $\Delta z_{opt}$ that resulted in successful expansion in the two patch model ($\Delta z_{opt} = 5$ and $\Delta z_{opt} = 10$). We simulated between 5 and 1960 patches across the landscape, therefore increasing the overall $b$ as more patches are present on the landscape (e.g. Figure \ref{fig:stepschematic}, solid lines).

We find growth rates are faster for larger patches and with a lower $\Delta z_{opt}$ (Figure \ref{fig:multistep}). As patch size decreases, growth rate decreases, and this decrease is faster for the higher value of $\Delta z_{opt}$. Greater dispersal distances increase growth rate with larger patches, but trade off at smaller patch sizes to become worse and lead to growth rates slower than the smaller dispersal scenario. In all cases, expansion fails on the linear gradient, as expected from our previous $b_{crit}$s found on linear gradients. Despite the ability to expand in a two patch model for some of these $\Delta z_{opt}$ values, more patches with this change in optimum between them make a prediction based solely on $\Delta z_{opt}$ inaccurate for the outcome of expansion.

\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1.1\linewidth]{Figures/UpdatedGrowthRatesByStep.pdf}}
\caption[Population growth rates across patchy landscapes.]{Population growth rates (number of individuals per generation) across patchy landscapes having a constant $\Delta z_{opt}$ of either 5 or 10. The size of each patch directly correlates to the number of patches on the landscape. The overall gradient increases with additional steps and can be calculated as $b = \Delta z_{opt}(number~of~patches - 1)$. The small dispersal kernel is for $\sigma_{disperse} = 2$ and the large dispersal kernel for $\sigma_{disperse} = 4$.}
\label{fig:multistep}
\end{figure}


%%%	\subsection{Predicting expansion on heterogeneous landscapes \color{red}does this part make any sense?\color{black}}
% report something like ratio of width to height for expansion ability
%%%	The failure of $b_{crit}$ to predict successful expansion on a heterogeneous landscape leads us to derive a new predictor of expansion success. \color{red}this isn't really the black and white answer I would like, so maybe redo or take this out? \color{black} We calculate a weighted measure of the local gradient by dividing the height of steps across the landscape by the width of steps on the landscape, and multiply this value by $\sigma_{disperse}$ to calculate this new weighted gradient value. Conducting a simple linear regression on the relationship between the weighted gradient value and population growth rate finds this to be a significant predictor of growth rate ($R^2 = 0.604, p < 0.0001$) and therefore the likely success of expansion over the landscape (Figure \ref{fig:linearmodel}). Though populations that fail to expand do appear below the critical value predicted, the observed and predicted upper limits of a non-zero growth rate are similar.

%%%	\begin{figure}[h]
%%%	\centering
%%%	\makebox[\textwidth]{
%%%	        \includegraphics[width=0.7\linewidth]{Figures/LinearModel.pdf}}
%%%	\caption[Linear regression of weighted gradient on population growth rate.]{Linear regression of weighted gradient on mean population growth rate across all scenarios simulated in this study. Growth rates of zero are colored in red, while nonzero are colored in blue. The fitted line (solid) predicts a critical value for positive growth rate to be below $\sim3$ while the observed critical value for a positive growth rate (dashed, gray) is at $\sim2.6$.}
%%%	\label{fig:linearmodel}
%%%	\end{figure}

%%%	Performing the same regression analysis within each genetic architecture regime only improves predictive ability for one scenario, but decreases it from the overall model. For the first genetic architecture regime, the predicted critical value for no population growth equalled $2.59$ while the observed critical value was equal to $2.50$. The $R^2$ for this model increases to $0.627$ ($p < 0.0001$). The other three genetic architecture regimes produce $R^2$ values all less than $0.6$ and predicted critical values that overestimate the observed critical value for zero population growth (Table \ref{tab:linearmodels}).

%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
%%%	\begin{table}[h]
%%%	\centering \footnotesize
%%%	\caption[Linear regression for predicting expansion success]{Results from linear regressions for predicting expansion success in terms of population growth rate for all simulation means, and broken into each genetic architecture regime.}
%%%	\label{tab:linearmodels}
%\begin{tabular}{cp{0.25\textwidth}cp{0.25\textwidth}cp{0.4\textwidth}c}
%%%	\begin{tabular}{lccc}
%%%	Regression model				&	Observed critical value	&	Predicted critical value	&   \\ \hline \hline
%%%	All scenarios					& $2.590267$	& $2.988544$	&	$R^2 = 0.6043, p < 0.0001$	\\  \hline
%%%	$\mu = 10^{-2}$; $\alpha^2 = 0.005$	& $2.590267$	& $2.49886$	&	$R^2 = 0.6309, p < 0.0001$	\\  \hline
%%%	$\mu = 10^{-3}$; $\alpha^2 = 0.05$	& $2.079442$	& $3.5474$	&	$R^2 = 0.5873, p < 0.0001$	\\ \hline
%%%	$\mu = 10^{-4}$; $\alpha^2 = 0.5$	& $1.89712$	& $4.079371$	&	$R^2 = 0.5592, p < 0.0001$	\\ \hline
%%%	$\mu = 10^{-5}$; $\alpha^2 = 5.0$	& $2.079442$	& $2.721747$	&	$R^2 = 0.5888, p < 0.0001$	\\ \hline
%%%	\end{tabular}
%%%	\end{table}
%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>






\section{Discussion}

%%MCW: I wouldn't frame this in terms of predictions, since the predictions didn't work well for the linear case. Instead talk about expansion being more difficult with discrete changes I the environment 
Our results have investigated two main questions: do predictions of range expansion from a linear gradient successfully extrapolate to heterogeneous gradients, and does the genetic architecture of a system impact the location of these critical gradient values. We find that predictions of range expansions from linear gradients do not fully extend to more heterogeneously changing environmental gradients. We also find that critical gradient values depend on genetic architecture and whether small or large effect mutations are possible in the system. 
%%MCW: If you return to thus later, it can be delayed here.  If not, it doesn't belong in this summary paragraph either. 
The interactions and effects of landscape heterogeneity and genetic architecture on determining adaptation and range expansion are important for understanding the ability of various species and taxa to react to climate change and successfully adapt to new environmental conditions. 

% move to end of discussion: In particular, sharp changes in environmental optima, as we examine, may be similar to changes in temperature which are predicted to increase in extremes and variability with climate change. Though we have investigated these changes in optima spatially, temporal changes may have

Previous studies have investigated range expansions across linear environmental gradients and the conditions for adaptation across the range or extinction \citep{Kirkpatrick:1997, Barton:2001, Bridle:2010, Polechova:2015}. Applying the prediction for a critical gradient from \citet{Barton:2001} estimates critical values on a linear gradient %%MCW: reword
that is much shallower than where our simulations show the limit to expansion occurring. Our simulation setup does not match to these studies in several ways, even on a linear gradient, hence we had no prior expectation for the predictions of a critical gradient value to closely match our observed critical gradient values for expansion. One major difference in our simulations, even for the linear gradients, is that the core starting population exists in a region of constant phenotypic optimum, and only outside of this core does the environmental gradient begin. Populations are burned in and thus well-adapted to the landscape core before expansion becomes possible in the model. Once expansion is possible, extinction across the entire species range is not possible since the landscape core can always sustain despite the steepness of the gradient. This differs from prior studies which do not possess such a core and can collapse to extinction when existing entirely over a gradient. %%MCW: Yes but the question us can it expand, not will it go extinct, so I'm not sure how big of a difference thus us
Therefore, in cases where a gradient may be too steep for a population to persist long enough in order to adapt is not an issue for our model because individuals dispersing from the core will continually be able to attempt adapting to the new environment throughout time without being subject to extinction. %%MCW: Ok, good point
This may explain in part why we find much steeper critical gradient values at which expansion outside of the core fails. It is furthermore inaccurate to call this result a biological range limit in the same sense used by prior studies since this stable range boundary only exists as a product of the surviving core population.%%MCW: reword this last sentence

A second, and perhaps more important, explanation for $b_{crit}$ predictions failing is due to their incorporation of the genetic variance, $V_G$, into calculating the critical value. 
%%MCW: reword
Measuring $V_G$ in populations and using this value to predict adaptive ability is not unfounded, but our results have shown that $V_G$ alone is insufficient to characterize or predict adaptive ability and thus range expansions. It is known %%MCW:Delete, or reword to add references
that increased $V_G$ is needed to successfully adapt to novel environments, and our results recapitulate this as can be seen on our heterogeneous, step landscapes where $V_G$ is greatly inflated at and around each environmental step in the landscape. %%MCW: I think this is causally backwards. Greater vg at breaks comes from migration, not because it is necessary to make the shift
Furthermore, it is known%%MCW:  AVOID IT IS KNOWN
 that $V_G$ evolves, which was also seen in our simulations. On steeper linear gradients, and steps of larger heights, equilibrium $V_G$ was much higher than for shallower gradients or smaller step heights (\color{red}I think there's going to be a supplemental figure on this\color{black}). Because $V_G$ can evolve, it is thus not a useful measure for predicting adaptive ability. Core populations' equilibrium genetic variances differed across our genetic architecture regimes, but once these simulations expanded onto gradients, $V_G$ evolved to similar values across regimes within a given gradient value.

%%we don't match bcrit expectations for several reasons
%%the major one begint hat there is no useful vg definition
%%it is defined on the landscape when it gets too steep
%%because vg can evolve

A useful aspect of knowing the genetic variance still remains, and that is its upper limit. %%MCW:What does it refer to? Vg?
Setting aside the effects of genetic architecture momentarily, we can see that the cases where expansion no longer succeeded are those for which $V_G$ became too large. Genetic variance that is too large results in a locally maladapted population as individuals are too different from their local phenotypic optimum. Across our genetic architecture regimes, we also found that too small a genetic variance  prevents range expansion except in the case where large effect mutations are possible.

%%\citet{Kirkpatrick:1997} do not allow the genetic variance to evolve in their model which finds either unlimited range expansion below the critical environmental gradient or extinction above it. Allowing genetic variance to evolve in \citet{Barton:2001} predicts that expansion always successfully occurs on a gradient and no range limits are formed. However, the latest work from \citet{Polechova:2015} incorporated both evolving genetic variance and genetic drift, and range limits are found under certain parameter conditions. 


The idea that $V_G$ is the necessary measure of a population to predict its adaptive ability is thus incomplete. We found a qualitative shift in the mechanism of adaptation and expansion across our genetic architecture regimes. The main driver of differing equilibrium $V_G$ was mutation rate, thus even when we hold $V_m$ constant, genetic variance decreased with decreasing mutation rates. This made expansion more difficult as the genetic material needed to adapt to new environments was reduced. However, the shift in our fourth genetic architecture regime whereby adaptation and expansion can again succeed, with increased time stalled below the step, suggested that larger effect mutations allow another path by which populations can adapt. %%MCW: This result is cool, but it could easily get lost in the rest. Highlight more? My be this question van be set up more directly in the intro. And isn't this only true in the discrete change cases?  This doesn't really come across here. 
From the subset of simulations performed with $V_G$ approximately held constant rather than $V_m$, we find that this does seem to be the case. At a given mutation rate, expansion was successful with fewer loci of larger effect, but more loci of smaller effect resulted in a shift back to the non-successful expansion regime. This alternative route for successful adaptation shows that $V_G$ alone is not a sufficient metric for prediction, and an understanding of genetic architecture and the potential for large effect mutations is key.

%% for our observed bcrit, we see differences among genetic architectures
%%shows that a certain amount of vg is required in order to successfully adapt to a new habitat
%%or that there is another regime of adaptation that depends on mutational input, and is slower but allows adaptation again on more steep landscapes


% LANDSCAPE ALSO MATTERED

Heterogeneity of the environmental gradient adds another major difficulty in predicting the success of range expansions. Using the critical gradient values observed in our simulations, within a genetic architecture regime, and applying these to predict expansion over heterogeneously changing landscapes breaks down as heterogeneity increases. The failure of expansion over heterogeneous gradients was driven by two factors: the magnitude of change in optimum at a given point on the landscape, and the size of the local region within which a constant environmental optimum exists. We saw that step height alone could prevent range expansion when step heights were too large, but the ability to expand over a single step did not guarantee the ability to expand over multiple steps of that same height. This latter point is intuitive because as steps become closer together in space, the landscape approaches a linear gradient and nearby environmental optima become more different than the local optimum. Without the ability for evolution of dispersal, constant dispersal distances within simulations thus lead to increased migration load and local maladaptation as individuals adapting to disparate environments increasingly interact across populations.

This point is emphasized by our comparison cases with larger dispersal distances. In all cases, increased dispersal distance made adaptation on a linear gradient, across a single environmental step, and across heterogeneous gradients more difficult. Though population growth rates were higher in some larger dispersal cases, this was only in scenarios not near to the limit of adaptive ability, i.e. cases where expansion was not difficult. With increased dispersal, time spent stalled at any given step was greater, and the critical gradient values for expansion over a linear gradient were much lower.


%% Schiffers: Using an individual-based allelic model, we explore the effects of different landscape structures on the rate of adaptation to novel environments and investigate how these structures interact with the genetic architecture of the trait governing adaptation and the dispersal capacity of the considered species. Generally, we find that rapid adaptation is favored by a good match between the coarseness of the traits genetic architecture (many loci of small effects versus few loci of large effects) and the coarseness of the landscape (abruptness of transitions in environmental conditions). For example, in rugged landscapes, adaptation is quicker for genetic architectures with few loci of large effects, while for shallow gradients the opposite is true. Moreover, dispersal capacities affect the rate of adaptation by modulating the apparent coarseness of the landscape: a gradient perceived as smooth by species with limited dispersal capacities appears rather steep for highly dispersive ones. We also find that the distribution of evolving phenotypes strongly depends on the interplay of landscape structure and dispersal capacities, ranging from two distinct phenotypes for most rugged landscapes, over the co-occurrence of an additional third phenotype for highly dispersive species, to the whole range of phenotypes on smooth gradients.




\subsection{Conclusions}

Understanding and predicting the adaptive capacity of populations is complex and manifold, yet necessary in order to understand species range expansions. We have shown that genetic architecture plays an important role in adaptation, allowing two separate mechanisms for range expansion through either sufficient genetic variance, or using the presence of large effect mutations. Intermediate between these two regimes, however, is a scenario where adaptation is limited and range expansion can be prevented. Increasing the complexity of environmental gradients also impacts the outcome of range expansion, where more rugged landscapes are more difficult to expand across. Knowledge of the scale of this ruggedness and the magnitude of change in environmental optimum combined with information on dispersal abilities of populations can serve as an approximate predictor for the success or failure of a range expansion. With the presence of climate change and other anthropogenic forces altering environments and species' habitats, these results have implications for predicting how species will fare as they attempt to adapt to new and changing conditions of the future.

\section{Acknowledgements}
We would like to thank Fr\'ed\'eric Guillaume for help coding \textsc{nemo} and members of the Whitlock lab for comments and feedback.



%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>
\begin{table}[h]
\centering \footnotesize
\caption[Per locus effect size differences]{Per locus effect size differences across scenarios of genetic architecture regimes. The range from minimum to maximum is shown for each scenario, as well as the mean.}
\label{tab:effects}
\begin{tabular}{ccc}
Genetic architecture	&	$\Delta z_{opt}$	&	Per locus difference: range (mean)  \\ \hline \hline
$\mu = 10^{-2}$	& $5$		& $-0.0674 - 0.4603 ~ (0.0190)$	\\ 
$\alpha^2 = 0.005$	& $7.5$		& $-0.0993 - 0.4884 ~ (0.0321)$	\\ 
				& $10$		& $-0.3633 - 0.5311 ~ (0.0479)$	\\ 
				& $12.5$		& $-0.4187 - 0.5464 ~ (0.0583)$	\\ \hline
$\mu = 10^{-3}$	& $5$		& $-0.0655 - 0.2864 ~ (0.0103)$	\\ 
$\alpha^2 = 0.05$	& $7.5$		& $-0.1233 - 0.7258 ~ (0.0277)$	\\ 
				& $10$		& $-0.4088 - 0.8786 ~ (0.0447)$	\\ 
				& $12.5$		& $-0.4308 - 0.6513 ~ (0.0596)$	\\ \hline
$\mu = 10^{-4}$	& $5$		& $-0.0144 - 1.1386 ~ (0.01799)$	\\ 
$\alpha^2 = 0.5$	& $7.5$		& $-0.2206 - 2.6775 ~ (0.0251)$	\\ 
				& $10$		& No expansion	\\ 
				& $12.5$		& No expansion	\\ \hline
$\mu = 10^{-5}$	& $5$		& ${-0.0055} - 2.6881 ~ (0.0228)$	\\ 
$\alpha^2 = 5.0$	& $7.5$		& $-0.1967 - 4.8746 ~ (0.0190)$	\\ 
				& $10$		& $-0.6236 - 6.4207 ~ (0.0522)$	\\ 
				& $12.5$		& No expansion	\\ \hline
\end{tabular}
\end{table}
%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>


\begin{figure}[h]
\centering
\makebox[\textwidth]{
        \includegraphics[width=1\linewidth]{Figures/wait_times_200.pdf}}
\caption[Time spent stalled during step crossing.]{Time spent (in generations) stalled at the step when crossing over 1 step in the environment for each regime of genetic architecture simulated and across varying magnitudes of step height. Points are jittered for visualization.}
\label{fig:waittimes200}
\end{figure}


%%% Local Variables:
%%% TeX-master: "thesis"
%%% TeX-PDF-mode: t
%%% End:
