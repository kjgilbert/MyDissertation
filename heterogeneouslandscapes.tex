\chapter{Genetic architecture and landscape heterogeneity interact to determine adaptation during species range expansion}%The role of genetic architecture and environmental gradients in adaptation during range expansion}
\label{chap:heterogeneouslandscapes}

\section{Abstract}


\section{Introduction}

% speciation, local adaptation, range expansion are all about adaptation to novel environments
%	in particular, adaptation in the face of gene flow

% it is still today a major question in evolutionary biology what alleles contribute to local adaptation
% and equally unknown (?) and much more hotly debated is how many genes are needed for speciation to occur? few or many? or a whole genome? or one magic trait?

% by examining range expansion over different types of heterogeneous environments and with different underlying genetic architectures, we investigate the ability for populations to colonize new habitat and adapt in order to undergo a species range expansion


%discuss the question of adaptation broadly - it's important in many aspects of evolution
The question of why species range limits exist has pervaded evolutionary biology for decades. Understanding populations' abilities to adapt to novel environments is key to this process, and is a major area of study across evolutionary biology in studies of speciation, local adaptation, invasive species, and conservation biology. 
Populations can locally adapt within their species range to survive across a range of disparate environments \citep{Kawecki:2004}. On a more extreme scale, populations may eventually reach a point of sufficient differentiation to produce new, isolated species adapted to different environments \citep{Rundle:2005, Doebeli:2003}. The capacity of invasive species to thrive depends on adaptation to new environments \citep{Prentis:2008}, and the potential for genetic rescue from assisted migration depends on the success of new genetic diversity aiding in adaptation \citep{Aitken:2013}. 
Regardless of whether adaptation results in the formation of new species or differentiated local populations, it remains a major question in evolutionary biology as to which and how many genes contribute to local adaptation. 

% talk about genetic architecture
Many studies, both empirical and theoretical, examine genetic architecture and its role in the ability to adapt to a novel environment \citep{Yeaman:2015, Yeaman:2011, Carroll:2001, Holloway:1990, Peichel:2001, Bratteler:2006}. It is known that a sufficient level of genetic variation, $V_G$, is necessary to provide the alleles required for adapting to a new environment. It was previously thought that many alleles of too small an effect may be swamped by gene flow before being able to contribute to sufficient local adaptation, but as shown by \citep{Yeaman:2015}, this effect is possible through transient processes subject to random genetic drift when rates and sizes of mutations and genetic redundancy are sufficient (though detecting the presence of such alleles remains a difficult task). It is clear however, that fewer loci of larger effect can contribute best to adaptation, which eventually lead to the building up of linked clusters of locally adapted alleles, often referred to as genomic islands of divergence \citep{Feder:2010}. Even when small effect alleles may contribute to adaptation, larger effect alleles build up and contribute to adaptive differences among populations \citep{Yeaman:2011}. As \citet{Renaut:2013} have showm in sunflower, genetic architecture plays a larger role in contributing to genomic divergence than does the geography of speciation. %make sure to go back and see what they mean by this "geography"
The details of genetic architecture are thus vital in studies of adaptation, and should not, nor need not, be ignored in today's era of genomic technologies. % eh, maybe remove the last part here, I am only doing a simulation study after all

% talk about landscape heterogeneity - in broad terms
Whether a certain genetic architecture will successfully contribute to adaptation in a new environment will also depend largely on the environmental difference at hand. There are clearly biological limits that exist in terms of adapting to environments of extreme difference in optimal phenotype, but within the realm of biological reality, there may still be limits to the change in environmental optimum to which a given genetic architecture allows adaptation. In the real world, environments are heterogeneous, and they change in multifarious ways over space, from gradual to sudden, and of minor or major magnitudes of change.
%The potential for genetic architecture underlying adaptation to interact with the environment to which populations are adapting is however less well understood. \emph{somewhere in here need to link better to the fact that I'm focusing on range expansions} %%

% talk about landscape heterogeneity in terms of range expansions
When considering environmental heterogeneity in terms of adaptation during range expansions, there are several important genetic processes that can lead to interesting hypotheses for adaptation across the landscape, making range expansions ideal for studying the combination of these effects. 
% Species exist on environmentally heterogeneous landscapes, and the degree of this heterogeneity can vary greatly within species ranges.
The characteristics of the environment available for a species to expand into plays an important role in the ability of populations to expand \citep{Aguilee:2012, Barton:2001, Pease:1989}. Increasing habitat heterogeneity, and thus heterogeneity in selective pressures, interacts with gene flow to influence the adaptive abilities of peripheral populations, and can in some cases inhibit local adaptation in peripheral populations \citep{Slatkin:1987,Kirkpatrick:1997, Ronce:2001}. During a range expansion, small founder populations at the margin experience reduced effective population sizes and reduced efficacy of selection. When this process repeats over the course of an expansion, the process of gene surfing \citep{Klopfstein:2006} can increase the presence of deleterious alleles and cause an expansion load at the range margin \citep{Peischl:2013}. This process is examined in more detail by Gilbert \emph{et al.} (hopefully submitted AKA, chapter 4 when I write this into thesis). %or remove this sentence and just talk about dispersal?
Due to reduced density at range margins, these populations experience gene flow at much higher proportions than any populations existing within the denser core os the species range. This asymmetric migration can behave in two disparate ways: introducing new genetic variation needed for further adaptation in an otherwise genetically depauperate population, or swamping locally adaptive alleles with foreign maladaptive alleles thus preventing further adaptation. Which of these processes occurs will depend on the details of migration rates, mutation rates, population sizes, and the degree to which the environment differs across the species range.

Previous theoretical studies have examined many of these aspects and their role in local adaptation at range margins during the expansion process. Higher gene flow has been shown to introduce more maladaptive alleles from greater distances and thus be more detrimental to the local population \citep{GarciaRamos:1997}. While others have shown the effect of evolutionary rescue from migration when marginal populations have small effective population sizes and behave as sinks \citep{Holt:1997,Gomulkiewicz:1999,Ching:2012}. Alternatively, if selection is strong enough or migration reduced enough, this can prevent the establishment of foreign alleles in a population allowing it to adapt sufficiently to local conditions \citep{Ronce:2001}. 

Foundational work in the field showed that on a linear environmental gradient, increasing steepness of the change in environmental optimum eventually leads to maladaptation at the margin and eventual extinction of the species \citep{Kirkpatrick:1997}. %Improving upon this study by allowing realistic and evolving genetic variance showed no limits to adaptation at a range margin, and a wider range of results when investigating temporally changing environments and varying population densities \citep{ polechova
Further investigations have improved upon this and shown the effects of density dependent selection \citep{GarciaRamos:1997} as well as stochastic effects on low density \citep{Bridle:2010}, temporal changes in environments \citep{Pease:1989}, differing dispersal parameters \citep{Aguilee:2012}, evolution of genetic variance \citep{Barton:2001,Polechova:2009}, and the impacts of genetic drift  \citep{Polechova:2015} on adaptation or the lack thereof at range margins. %\citet{Case:2000} also incorporated species competition, under which they found similar results only with a shallower environmental gradient needed to limit range expansion. Some of these models use the same linear gradient of an environmental optimum changing at a constant rate over continuous space, while others simulate adaptation to differing environmental optima across discrete space (habitat patches) within which  individuals of a patch possess no explicit spatial designation. The results of these discrete environment models also show the potential for species to either adapt and persist, exist as non-adapted generalists, or go extinct.
%  **** include this and improve on the summary of other studies? --> One may predict that a given difference in optimum phenotype can be attained equally from few loci of large effect or many of small effect, but such a process will clearly rely on important details of migration, mutation, selection, and genetic drift. (cite someone here?) Strong asymmetric migration can swamp locally beneficial alleles and prevent adaptation (cite Kirkpatrick and barton, and others). Weak selection and strong genetic drift can prevent beneficial alleles from establishing (true??). And mutation may drive the presence of genetic variation needed to allow adaptation to novel conditions.
These studies have all largely investigated adaptation in models of two discrete habitat patches of different environmental optima or across linear gradients in continuous space. Yet both of these situations differ largely from biological reality, where environmental changes exist in some combination of these two layouts: contiguous space with varying levels of gradual or abrupt environmental changes distributed patchily across space. %may occur more or less frequently in space and to a greater or lesser degree of difference in phenotypic optimum. 
These differences in landscape play a key role in the process of populations adapting because of their potential to interact with the effects of evolutionary processes at the range margin. 

% set up our hypotheses/goals
When discrete habitat types exist contiguously across space, will the dynamics of the system reflect those of the continuous or the discrete models? The combination of such environmental landscapes however, has not been sufficiently explored. \citet{Barton:2001} suggested the ability of populations to persist across environments of accelerating gradients, but in depth examination of different types of environmental heterogeneities is warranted. Because discrete models have as of yet not extended past two patches, it is unclear what effects a third or additional patches may have on evolution and adaptation within the system when space is explicit within each patch. With larger environmental differences in optima, will only large effect mutations be able to contribute to local adaptation and small effect alleles still swamped at the range margin?

% this project's hypotheses
In this study, we test if different genetic architectures and landscape heterogeneities can interact and affect the outcome of adaptation during a species range expansion, and potentially even limit a species range expansion.
% how we're going to test those hypotheses
To address this question, we simulate a spatially explicit and discrete two-dimensional landscape across which populations are allowed to expand their species range and adapt to newly encountered environments. We model a range of genetic architectures for a quantitative trait to test for differences in ability to adapt to environments. We also compare this across environments that differ in their degree of environmental heterogeneity from few to many locations of change in environmental optima, as well as in terms of the magnitude of change for each of these optima. Examining the rate of range expansion and the time required for populations to colonize and adapt in new environments provides insight into the role of both genetic architecture and environmental heterogeneity in determining the success or failure of adaptation. Such results are highly informative for the field of evolutionary biology, and largely applicable in predicting the fate of many species across the globe requiring the ability to adapt in the face of disturbance and shifting species ranges due to climate change and other anthropogenic environmental perturbations.


%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>

% marginal populations thus often exist only as a sink, sustained by immigration until sufficient local adaptation is achieved. % and recovery from expansion load? -- refer to Ch 4 here, i.e. refer to our group project paper -- or just talk less about load since I'm not studying it in this paper
% When the population shifts to be a self-sustaining source, it escapes the effects of drift, and provides emigrants for further colonization and range expansion. This shift from sink to source also includes a shift away from asymmetric migration previously swamping locally adaptive alleles with foreign maladaptive alleles.

%Local adaptation within a species not only benefits populations in terms of fitness but also has repercussions for a species' global range. A species' range is defined in some cases by sharp visible boundaries, such as distinct geographical changes in landscape features, or equally understandable ecological reasons such as competitor occurrence or nutrient limitations. In instances where no such clear reason for a range edge exists, understanding what forces limit expansion and adaptation at the edge of a range becomes an evolutionary question \citep{Bridle:2007,Kawecki:2008,Excoffier:2009}. Barriers to dispersal may prevent expansion past the edge, however gene flow can also act to inhibit local adaptation in peripheral populations \citep{Slatkin:1987,Kirkpatrick:1997}. This, in combination with different selective forces from environmental gradients across the landscape, may prevent expansion. The characteristics of the environment available for a species to expand into plays an important role \citep{Aguilee:2012,Barton:2001,Pease:1989}. Increasing habitat heterogeneity, and thus heterogeneity in selective pressures, interacts with gene flow to influence the adaptive abilities of peripheral populations \citep{Ronce:2001}.

% Under one of the first models to examine the question of adaptation across species ranges \citep{Kirkpatrick:1997}, it was shown that three different scenarios could result: species extinction, a limited species range, or unlimited expansion of a species. Other studies have examined scenarios similar to this model and incorporated more realistic simulation methods that were previously not investigated: density dependent selection \citep{GarciaRamos:1997,Gomulkiewicz:1999} as well as stochastic effects on low density \citep{Bridle:2010}, temporal changes in environments \citep{Pease:1989}, differing dispersal parameters \citep{Aguilee:2012}, and evolution of genetic variance \citep{Barton:2001,Polechova:2009}. \citet{Case:2000} also incorporated species competition, under which they found similar results only with a shallower environmental gradient needed to limit range expansion. Some of these models use the same linear gradient of an environmental optimum changing at a constant rate over continuous space, while others simulate adaptation to differing environmental optima across discrete space (habitat patches) within which  individuals of a patch possess no explicit spatial designation. The results of these discrete environment models also show the potential for species to either adapt and persist, exist as non-adapted generalists, or go extinct.

%Equally relevant to studying adaptation in a local adaptation or speciation context, is the study of adaptation during a species range expansion. As a species range expands, it encounters novel habitat to which it must adapt. Previous studies have shown that it is the ability of populations at range edges to adapt to these new environments that can determine the ability of a range to expand (citations). Not unlike parapatric speciation, this adaptation to new environments must occur in the presence of gene flow. Asymmetric gene flow at a range edge, however, can cause migration load that is particularly strong when an edge population is still a sink and requiring the influx of individuals to persist.

%Species range limits and the capacity for range expansion has long been a question in evolutionary biology. A species' range is defined in some cases by sharp visible boundaries, such as distinct geographical changes in landscape features, or equally understandable ecological reasons such as competitor occurrence or nutrient limitations. In instances where no such clear reason for a range edge exists, understanding what forces limit expansion and adaptation at the edge of a range becomes an evolutionary question \citep{Bridle:2007, Kawecki:2008, Excoffier:2009}. Barriers to dispersal may prevent expansion past the edge, however gene flow can also act to inhibit local adaptation in peripheral populations \citep{Slatkin:1987, Kirkpatrick:1997}. This, in combination with different selective forces from environmental gradients across the landscape, may prevent expansion. 

%% Dick Gomulkiewicz said at EvoWibo 2012 that Bob Holt may be doing a 3-island model of this stuff; check back on this!
%% Amy -- you haven't explained whether/how there are different results from models with discrete vs continuous habitats (or why you would expect the difference to matter), so this contrast is not motivated for the reader.  

%<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>



\section{Methods}

\subsection{Simulation Model}

% quick simulation summary
We model a range expansion on a two-dimensional landscape using individual-based simulations from a modified version of Nemo (Guillaume and Rougemont 2006). Individuals are monoecious diploids (hermaphrodites) that possess a quantitative trait with 100 underlying loci. Quantitative alleles mutate at rate 0.0001 unless otherwise stated and the mutation variance parameter was varied as described in the results. 

% now go into all the gory details:
Free recombination was allowed, VS on the trait was set to 7.5 and an environmental variance of one was allowed. Each cell on the landscape (see below) is given a value that sets the optimum phenotype at that location to which the quantitative trait adapts under balancing selection. The life cycle consisted of four events: breeding, dispersal, viability selection, and regulation. Because we sought to simulate individuals that exist on spatially explicit landscapes, we modified the Nemo code as follows (code available at https://github.com/kjgilbert/NemoDispersalKernel). To make the presence of an individual within a deme more spatially explicit, we considered each of Nemo's patches to instead be a cell on the landscape grid and simulated many cells across the landscape. We set carrying capacity K = 5 within each cell, individual fecundity to an average of 4, and allowed mating to occur within a breeding window. This breeding window specifies the distance within which a potential mate can be found and the likelihood of mating with that individual based on a Gaussian kernel. Because modeling a range expansion 
implies that there will often be lone colonists on the expansion front, this addition of a breeding window increases biological realism by allowing lone colonists on the range front 
to still potentially find a nearby mate, even if they are the sole inhabitant of their cell. This most closely resembles obligately outcrossing plants, who may receive pollen from nearby 
mates, but could also represent animals that search for mates nearby and return to their home territory. This increases our local effective population size above the scale of cells to 
approximately    ~~~~ . The size of this breeding window is defined in the same manner as the dispersal kernel. A 1-dimensional probability distribution is drawn, defined by one standard 
deviation of a Gaussian distribution $\sigma$, which is then multiplied by itself to create a 2-dimensional kernel. This is reduced to include only probabilities equal to or higher than the smallest 
probability from the 1-dimensional kernel, and is then renormalized. Upon mating, offspring are then placed in the mother's cell, after which dispersal would proceed as normal in the 
subsequent life cycle event. 

Individuals existed on a landscape 2,000 cells long and 40 cells wide. A burn-in period 
of 7,500 generations occurred in the first 40 by 40 cells and after the burn-in, the 
remainder of the landscape was opened to allow range expansion to occur. Simulations 
were run for a total of 25,000 generations with 10 replicates per scenario unless otherwise 
indicated. Landscape boundaries were absorbing, so individuals who migrate outside of the 
landscape die, and individuals at the boundary have fewer cells in their potential breeding 
window. Unless otherwise stated, $\sigma_{breed} = 0.5$ (most mates come from within your cell, but 
the 12 surrounding cells had non-negative probabilities of finding a mate), and $\sigma_{disperse} = 2$ 
for ``small dispersal kernel`` and 4 for ``large dispersal kernel`` (See supplemental text ~~~ for 
further description). 
Landscapes
We ran simulations over a range of optima values across the landscapes. The burn-in area, 
hereafter termed the core, was consistently kept at a constant optimum value to ensure that 
the population was well-adapted before populations expanded onto the environmental gradients. 
Beyond the core, several types of environmental gradients were tested. Unless otherwise stated, 
environmental optimum only changed in one dimension, the axis of expansion (x-axis), and was 
constant over cross-sections (y-axis). The slope of the overall gradient is defined by the 
parameter b, obtained by dividing the total magnitude of change in environmental optimum 
from one end of the landscape to the other, $h_{total}$, by the total length of the landscape (2,000). 
Linear gradients are those where the landscape optimum changes at every subsequent cell in the x 
direction by a constant value $h_{step}$ outside of the core. Heterogeneously changing landscapes have 
constant optima within local regions of the landscape (steps) that change periodically by value $h_{step}$. 
Multiple different scenarios can represent the same total change in landscape optimum (Figure 1a) 
while the frequency of steps in space can also result in different total changes in landscape 
optimum (Figure 1b).

Figure 1 - Visualizations in 1-dimension of heterogeneously changing environmental gradients. 
Each horizontal portion is referred to in the text as a step. $h_{step}$ is a measure of the vertical 
distance between steps while $h_{total}$ is the total change in environmental optimum from one end 
of the landscape to the other. Panel A shows gradients that have the same overall slope, b ($h_{total}$ = 200), 
but different magnitudes of change in the local optimum, $h_{step}$. Panel B shows gradients that 
have different overall slopes, b, but the same magnitude of change in the local optimum per 
step ($h_{step}$ = 4).

\section{Results}

On a linear environmental gradient, overall slope of the gradient relative to mutations 
available determined whether populations would expand across the landscape. Larger variance 
in mutation effect size allowed steeper gradients to be occupied (Figure 2). Fewer replicates 
expanded over gradient values near the limit of expansion ability (Figure 2) and took more 
generations to expand.

Figure 2 - Gradient and mutation parameter combinations that do and do not expand across 
the landscape. Each plotted point represents 10 replicate simulations. Points indicated 
by + have consistent results across replicates, indicated by text in the gray shaded areas. 
Variation in expansion speed across replicates can be seen in figure S1.

However, when the environmental gradient changes heterogeneously across the landscape 
instead of linearly, overall slope no longer determines success or failure to adapt and 
expand across the landscape. There are two factors that account for adaptation and 
expansion in such cases of heterogeneously changing gradients: the magnitude of the 
change in optimum from one cell to the next and the frequency at which these changes 
occur over the landscape.
Magnitude of Optimum Change
	The effect of the magnitude of change in environmental optimum on ability to expand 
	was tested by simulations on environmental gradients that had only one location of 
	change in the optimum (e.g. Figure 1A, thickest black line), hereafter referred to 
	as a step. Such a setup may be compared to a spatially explicit 2-patch model. The 
	ability of populations to adapt to the other side of the step and expand to fill the 
	landscape was driven by total mutational availability, defined here as the mutation 
	rate times the variance in mutation effect size (Figure 3). Smaller steps are easier 
	to cross under a range of mutation parameters, but larger steps require that larger 
	effect mutations be available.

Figure 3 - Gradient and mutation parameter combinations that do and do not expand. Each 
plotted point represents 20 replicate simulations. Because the landscape optimum only 
changes at one step location in the center of the landscape, hstep = htotal. Variation 
in expansion speed across replicates can be seen in figure S2.

Frequency of Optimum Change
	The htotal values which resulted in expansion for a single step did not however result 
	in expansion for the same htotal values on a linear gradient. Therefore we sought to 
	uncover the relationship between step height and step frequency. We investigated this 
	in the context of a subset of mutational parameters, as well as two dispersal distance 
	parameters for values of h that allowed expansion over a single step.
	Figure 4 summarizes these results as measured by speed of expansion for the various 
	scenarios. Larger values of hstep again make range expansion more difficult, and larger 
	effect size mutations improve ability to adapt and expand. An interesting interaction 
	occurs between dispersal distance and ability to expand. When steps are infrequent 
	(Step width > ~20-50 depending), having a larger dispersal distance speeds up expansion, 
	since on average individuals can migrate farther every generation. Because optimum 
	changes are rarer, populations are able to adapt to their local step, as indicated by 
	higher fitness measures in Figure 5a. However, when steps become more frequent over 
	the landscape, this larger dispersal distance becomes detrimental and slows expansion.
	
Figure 4 - Each point is an average of 10 replicates. Step width = 1 is equivalent to a 
linear gradient. Rate of expansion = zero indicates that expansion did not occur.

The slowed expansion is due to several factors. When steps are too frequent in space, there 
is insufficient space for individuals to adapt to their local optimum without migrants from 
nearby steps contributing maladaptive individuals. This is shown by mean fitness values 
averaged across the center of steps decreasing as step frequency increases, and by genetic 
variance averaged across the center of steps increasing as step frequency increases (Figure 5).

Figure 5 - Mean fitness (A) and genetic variance (B) averaged across the center of steps per 
simulation, and then averaged across 10 replicate simulations per data point shown. Points 
not shown are scenarios that did not expand.

Causes (?) of success/failure to expand
As shown in figure 5, as steps increase in frequency across the landscape, genetic variance 
increases and fitness decreases. These qualities are the defining factors in determining whether 
populations are able to adapt and expand over changes in the environment (cite all the papers 
where too high genetic variance = extinction, but probably move this to discussion). Too high 
genetic variance results in maladaptation to the local optimum, decreased fitness, and eventually 
in local extinction. However, returning to the cases where there is only one step where the 
environmental optimum changes, we find that there is also a minimum amount of genetic variance 
necessary to adapt to new environments (Figure 6). When the hstep is smaller, less drastic 
mutations are required to survive across the step, so genetic variance does not become greatly 
increased (red lines Fig 6). As hstep increases, increasingly different genotypes are necessary 
to survive in the new environment, inflating genetic variance at the location of the environmental 
change as populations adapt to either side. When hstep is too large, the necessary mutations are 
not seen arising in the population, and individuals beyond the step are only a sink population 
and still adapted to the environment before the step, maintaining a low genetic variance.

Figure 6. - Genetic variance among the two cross section immediately preceding the environmental 
step (80 cells), among the two cross sections immediately after the environmental step, and 
among these four cross sections. 4 replicate runs are shown. Cases shown in red which easily 
expand, do so immediately after the burn-in ends, while cases in blue begin expanding later, 
and cases in green never succeed in expanding beyond the step.

To do: the cases in blue in fig 6 need to be scrutinized further. What mutations arise 
right when they start to expand?
	The mutations that arise in populations at the step…
		Look at their effect sizes
		Look at how many it takes



\section{Discussion}

Because previous studies (citations) found the steepness of the environmental gradient to 
determine ability to expand, as was recapitulated here, we then further investigated the underlying 
factors that impact this ability. This was done by teasing apart the effects of absolute magnitude 
of change in environmental optimum and the frequency of this change over space. As we have shown, 
on a linear gradient where expansion for a given parameter set is able to expand, the same 
parameter set can no longer expand when the environmental change is reorganized into one “step” 
in the landscape.
	The ability to cross a single step in the landscape is driven by the mutations available 
	to the system. More mutations of larger effect allow individuals migrating across this 
	step to adapt to the new landscape optimum and spread across the remainder of the landscape. 
	This result is similar to that of Gomulkiewicz (citation) where instead a 2-patch model 
	is simulated, and the second patch switches from a sink to a source when… ~~~~~ .
	Interestingly however, the ability of a parameter set to cross a single step does not 
	guarantee its ability to cross multiple steps. In these cases, the frequency of steps 
	occurring over the landscape impacts the ability of populations to expand and adapt.



%\section{Acknowledgements}
%We would like to thank Fredéric Guillaume for help with Nemo and members of the Whitlock lab 
%for feedback on the project. …


%%% Local Variables:
%%% TeX-master: "thesis"
%%% TeX-PDF-mode: t
%%% End:
